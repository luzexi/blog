---
layout: post
status: publish
published: true
title: 《Unity3D高级编程之进阶主程》第三章，数据表(一) - 数据表的种类
description: "unity3d 高级编程 主程 数据表 xls Json Xml 多语言"
excerpt_separator: ===
tags:
- 书籍著作
- 版权著作
- Unity3D
- 前端技术
---


在游戏项目中缺少不了数据表，数据决定了游戏的整个进程，因此怎么用数据表配置数，配置数据时是否方便成了关键的问题。

那么如何来理解数据表的存在呢？数据表完全可以认为是一个本地的数据库，只不过这个数据库里的数据是不可被修改的，是只读的。可以这么说，在实际项目的开发中，它们大部分从Excel里生成出来，再导入到游戏中去的，也有其他的各种方式，比如使用比较原始的方法直接写在代码里，下面的内容中我们来讲讲数据的存放种类。

数据表的在项目中的作用是什么？数据表是连接美术，设计策划，和程序的桥梁。艺术家们用它来配置效果，设计师用它来调整游戏的数值平衡，程序员们用它来判断逻辑。所以数据表的意义非常大，是连接各个环节的桥梁。

===

### 大部分数据都是在Excel里填写生成的

自从微软创建出神级的Excel后，全世界都爱上了这款软件，无论自用还是商用，制图还是分析都离不开它了。

居我的了解，基本上所有的公司都在用excel。而且，只要跟数据，数字，接触的职业，都会大量使用excel来做数据分析，数据制表等工作。

它能给你所有你想处理数据的功能，而且快捷，方便，易于保存，上手快，方便传播等等等，说不完的好品质。

所以呢，游戏行业里数值策划更是喜欢这个工具了，我们的游戏数据跟excel分不开，我们需要用它的来加快效率，特别是数据开发，数值平衡的工作。

现在你应该明白了，我为何如此夸大的它的优秀，因为他确实在很大程度上加快了项目的进度。

下面说所的数据表，基本上都是意味着从Excel文件中导出来的数据的集合。

### 最原始的数据方式，代码数据

最最原始的数据，是写在程序里写着的，这种一般都是临时级别的数据，在更改，增加，删除时增加了大量的程序员的工作量。

然而让策划人员去自行更改代码里的数据，不但增加了修改程序的风险，也让数值策划人员批量修改数值的难度增加好几倍。

所以这种放在代码里的数据，基本都只存在于Demo阶段，或者mini游戏中，因为数据量小，更改的次数少，不会特别去在意数值的平衡性。

数据放在代码里的原因就只有一个，快，制作快，使用快，效率快。不需要建立与其他部门的桥梁，只要程序员自己动手就能搞定。不需要像Excel那样，需要建立先Excel表，制定规则，再转化数据，再加载，再解析等步骤后才能使用。代码里的数据，程序员们直接就能用。

因为只有程序员知道是什么，为什么这么写，也只有程序员能看明白，所以当数据使用量逐渐增大，或者使用规则逐渐复杂，或者数据的修改次数逐渐增加，就会渐渐觉得对于小改动的花费的精力太大，效率也大幅降低。

### txt文本数据

文本是一种常用的数据表形式，例如用.Json，Xml，Csv为扩展名的文件，里面全是字符串形式的文本，包括数字在内也都以字符串的形式存在，在当程序读取这些字符串内容后将它们转化为相应的数据类型，整数，浮点数，文本，数组。于是这些字符串以怎样的规则存储在文件中是一个比较需要考究的东西了，因为我们还要解析它们。

文本读取规则有很多标准形式的，包括Json，Xml，CSV等，这些都是常用的文本读取规则，在很多情况下用文本读取字符串形式的数据然后按规则来转化成相应的数据和数据组是极佳的选择。它的优点是肉眼能很直观的看到数据，并且也容易查找问题，并能立即直接对文本进行修改，无需其他工具。

像文本这样的数据存储方式，如果为了方便快捷，把数据直接用逗号隔开，或者用空格隔开，或者用特别的符号比如';'分号等形式隔开，就可以作为一个数据的规则格式，无需其他复杂的协议商定。

还记得我们主要的数据开发工具是Excel么，为了能从Excel里更容易的导出数据，我们会选择一些更加简单实用的导出方式。比如直接从Excel里复制粘贴数据到txt文件，这是最直接的手动导出方式。

也有用Excel直接保存CSV格式的，它是以','逗号开的格式的文本文件。

这些都是比较容易的方式，如果要做到不手动，而是用程序工具转化，那就写个程序读取Excel文件内容，程序看以直接导出相应的格式的文本文件。

写一个程序工具来导出Excel的数据，会有很多格式可以考虑，比如我们前面提到的，Json格式，Xml格式，以及自定义格式，每次导出时都会将数据在内存中以一定规则排列好，再导出到文本文件。

通常使用过工具导出Excel数据的同学，以后都会非常喜欢使用使用程序工具导出数据，因为这样会更高效。当他们已经熟悉了这套流程和方法，在制定项目模块规划时，就很习惯性的把程序自动导出数据的模块规划进项目里，对他们来说，这是顺手拈来的事情，而且这事很容易做到，一劳永逸。

这种程序化代替人工操作的事，我们通常称为自动化或流水线。其实自动化是最终的目标，我们希望任何工作都可以自动化来代替，从而减少人工手动操作导致的失误，同时也减少了工作量，减少了同学们不必要的精力消耗。

### 比特流数据

数据比特流是一种稍微底层点的数据表现形式，他是将数据转化为二进制形式存放在文件里，然后程序通过读取二进制文件，按一定的规则将其转化为所需要的数据。它比起文本形式的数据文件，比特流数据文件特点是，占用的空间更加小，读取速度更快，但缺点也同时存在，通用性差，无法直观和任意的修改。

为什么会更加小，二进制比特流在存储数字时，会直接用二进制形式存储，比如，txt文本中23345是“23345”这个字符串，占用了5个字符，每个字符2个字节，就用了10个字节，而二进制比特流则在存储时可以直接使用二个字节(short)存储’23345‘这个数字，所以数据比特流形式的数据存储文件更加小。一个以文本形式的txt文件来建立的10MB的数据文件，转化为2进制格式后，可以压缩到几百KB甚至几十KB。

一个10MB的文件在读取的时候是很消耗CPU的，假如项目中有几个甚至几十个这样的数据文件，在游戏进行中的卡顿是难免的。这么大的数据文件光读取整个内容就已经很消耗CPU资源了，更别说，还需要在读取文本数据后进行解析。庞大的文本解析工作，让成千上万个字符串转化为数字或者浮点数，会消耗比较多的CPU计算量。

其实比特流数据和数据网络传输时使用的协议是一个道理，有人使用了json格式的数据协议来传输网络数据，所以当数据大时，json字符串占用的数据量也非常大，启用压缩算法也不能解决根本问题。因此很多人转而使用数据比特流形式的数据协议来传输网络数据，以减少网络数据占用量，即使在网络不稳定的情况下，因为体量比较少，能够准确送达的概率也大了很多，从而网络性能也提高了很多。关于网络协议具体内容，会在以后的章节中一一介绍。

以比特流形式作为协议的标准很多。比如最近比较流行的，Google protobuf，还有MessagePack。

这里简单介绍下Google protobuf：

		protobuf是一个开源项目，而且是后台很硬的开源项目。网上现有的大部分（至少80%）开源项目，要么是某人单干、要么是几个闲杂人等合伙搞。而protobuf则不然，它是Google公司开发的，并且在Google内部久经考验的一个数据协议。
		
		那这个听起来牛X的东西到底有啥用处呢？简单地说，这个东西干的事儿其实和XML差不多，也就是把某种数据结构的信息，以某种格式保存起来。主要用于数据存储、传输协议格式等场合。

protobuf有什么特色呢？我们将这些数据协议内容放在网络层的章节里讲。


