---
layout: post
status: publish
published: false
title: 游戏客户端针对业务逻辑的性能优化总结1
description: "unity3d gameplay 性能优化 总结"
excerpt_separator: ===
tags:
- Unity3D
- 前端技术
---

内存存取的速度模型

硬盘
内存
高速缓存1
高速缓存2
高速缓存3
寄存器

单核计算，数据存取，多核并行计算

资源加载，贴图文件、模型文件、动画文件、配置文件

CPU计算耗时分布，图形引擎、UI系统、业务逻辑、音效、网络、日志、其他三方SDK，加载，实例化

GPU耗时分布，Drawcall、贴图存取、数据存取、Overdraw、阴影绘制

框架支撑业务逻辑，但世界上没有完美的框架，所有框架都会随着业务逻辑的发展而变得臃肿。好的框架慢一些，坏的框架快一些。

我们要做的事就是，将这个给这个胖子减肥，给臃肿的业务逻辑瘦身。有时也需要改造或更换框架，风险大，但是是一个长期好处多多的一项优化内容。

方法论：先找出问题，找出问题的重点或定位点，再优化问题。优化的时间有长有短，按重要程度排序。

业务方向：镜头内外区分对待，不同等级设备做资源LOD，不同等级设备做业务功能LOD，业务按重要性级别做LOD，内存加载与销毁的优化，代码业务通用优化，代码执行效率级别的优化，根据引擎逻辑特性做优化，利用多核并行计算，多线程之间的无缝衔接优化，CPU计算量向GPU转移(GPU Instancing，Shader 动画)，预计算处理，技能配置检查。

渲染管线方向：前置深度测试，剔除，阴影方案，shader精度简化，shader复杂函数优化

引擎方向：骨骼动画优化、模型压缩、拖尾优化、GPU布料、Timeline优化、特效cutout

手机厂商定制方向：cpu白名单，针对手机设备额外功能的优化，手机厂商支持优化测试

代码执行效率方向：减少内存存取次数，减少内存分配次数，内存对齐，

工具：xcode instrerment，Android ndk simpleperf，unity profiler，unity 内存快照，自定义打点程序，自制内存快照工具。

分析数据：CPU整体耗时分布（UI，动画，渲染，粒子，相机裁剪），业务各模块耗时分布，内存占用分布，卡顿时的耗时分布

目标数据：平均帧率，最低帧率，单帧最大耗时，总卡顿次数，卡顿次数/10分钟，内存峰值，平均内存，miss命中率

测试场景：可重复的测试场景，拆分不同地点的测试场景，同一规模单体测试，同一规模的多体测试。


寄存器当参数最多16个，超出的只能使用内存栈代替

