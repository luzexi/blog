---
layout: post
status: publish
published: false
title: 《Unity3D高级编程之进阶主程》第五章，3D模型与动画(四) - 3D模型的变与换2
description: "unity3d 高级编程 主程 "
excerpt_separator: ===
tags:
- 书籍著作
- Unity3D
- 前端技术
---

上一篇介绍了一些3D模型的渲染基础知识，并且将这些基础知识运用在了3D模型的切割、拉伸、扭曲当中。

技术原理是最重要的核心点，人只要理解了技术原理，就能将技术表象解释清楚，并在实际项目中将这种技术运用自如。

实际中并没有这么容易，理解和运用自如之间，还是有一段很大的差距的，在实际项目过程中，理解只是理解，只是能解释这种表象是如何发生的，运用自如，则是熟知了原理的优缺点，也不再对这种技术有任何的偏见，没有了这么多的偏见，运用起来得心应手。

理论上说，我们每个人把所有精力先放在理解原理上，然后再去做技术实现不就轻松了吗。理论上是这样的，但人类头脑的进化毕竟还没到那么高级的程度，还不能轻松的把抽象的事物短时间内在脑中有条不紊的整理清楚，这还没把人的情绪影响算进去，虽然表面上能处理一些看上去相对复杂的事物，但从学习知识的角度看，人类的大脑还是不够高级，说实话应该说是有点低级。

对于这么低级的大脑，我们只能通过反复的学习，然后实践，再学习，再实践，很多遍后才能对原理的理解推进那么一点点，也只能依靠长时间磨练，从有兴趣到放弃再重新拿起再放下，反反复复但始终不离弃，才能最终练就运用自如的境界。人没有聪明与不聪明之分，有的人善于思考，善于举一反三是因为前面很长一段时间他都一直在练习这种多思考和举一反三的方式，当我们看到他时他的思维方式已经成型，并不是先天就有，而是通过努力得来。

3.简化模型

模型面数多的好处是能表现的更加精细，画面更细腻，但坏处却是加重了渲染压力，渲染的面数越多压力越重，帧率越低。

画面质量和性能需要权衡，通常都是要求模型降低面数而画面质量不变，LOD(Level Of Detail)在这里发挥了巨大的作用，随着镜头的靠近逐级更换更细腻的模型很好的解决这种需求。

简化模型在LOD中用到的最多，有手动用3D模型软件简化的，也有用程序工具式的简化模型，手动简化更加平滑但费时间，时间成本大，而用程序工具去简化则快速，但不平整。我们可以根据项目的需求，规模，画质等要求来权衡是否使用程序工具去简化模型，或者更加灵活点，一部分不太讲究的模型使用程序工具简化，而另一部分比较讲究的模型使用手动简化。

这里我们来具体讲述下简化模型的算法。虽然市面上简化模型的插件和工具很多，但如果我们对原理有了更深入了解，在实际的项目中运用这些工具会更加自如且得心应手。

3D模型是由点，线，面组成。面由点线组成，减面相当于减点和线，单纯的减去点和线容易引起模型巨变，唯有销毁线（或者称为收缩）的同时合并两端的点才是正确的道路。[Garland et al. 1997]提出了一种基于二次误差作为度量代价的边收缩算法，其计算速度快并且简化质量较高。

该方法在选择一条合适的边进行收缩时，定义了一个描述边收缩代价公式Δ，对于网格中的每个顶点v，我们预先定义一个4×4的对称误差矩阵Q，那么顶点v=[x y z 1]的代价为其二次项形式Δ(v)=vQ。

同时也定义了边收缩的代价公式，假设对于一条收缩边(v1,v2)，其收缩后顶点变为v3，我们定义顶点v3的误差矩阵Δ(v3)为Δ(3)=Δ(1) + Δ(2)。


4.捏脸和飘动



蒙皮网格(SkinnedMesh) 和 普通网格(Mesh) 的不同。

蒙皮网格渲染的是模型，由3D模型数据组成，普通网格渲染的也是模型，也有3D模型数据。

但是蒙皮网格主要是为了动画服务的，所以蒙皮网格除了3D模型数据外还有骨骼数据。

如果蒙皮网格没有动画，和普通网格的作用没有任何区别，只是用了不同组件去渲染罢了。

说到动画，这里也简单阐述一下动画的原理，后面章节会详细阐述。

动画分骨骼动画 和 顶点动画两种。

这两种都是通过改变模型上的各个顶点位置，从而让模型变形，进而形成动画的效果。

那么模型上这么多成千上万的顶点每个都要手动来调整，每一帧手动调整一次，这种量级的劳动力，人类无法承受，所以有了骨骼这个概念。

骨骼就是为了，节省劳动力来生的，一个骨骼可以影响周围一定范围内的所有顶点，一个顶点，也可以受到多个骨骼的影响。



，理解技术原理比较困难，为什么困难，因为

我们来说说模型的切割表象和技术实现。

###	如何对3D模型表面进行实时变更。(https://zhuanlan.zhihu.com/p/28471808 捏脸，骨骼点移动，旋转，缩放，Mesh大小差值实时生成)

对3D模型Mesh实时改变在很多场景中也是很有用的。比如Mesh地形挖坑，捏脸，物体切割，还有像《白猫计划》中的泡泡摇杆等。


Unity中模型发生闪烁原因通常情况下是因为其中两个面距离太近了。 

这里有两个解决方法 

1，增加导致闪烁的两个面的距离

2，增加摄像机最近裁切面的值

3，修改Shader中ZTest 中的 LEqual 修改为 Less

4，改变着色器的渲染次序，RenderQueue + 1


为什么两个面靠的近，有时候会闪烁，有时候又不会乃？ 

模型闪烁根本原因是Unity中模型的点信息是双精度的，GPU处理模型过程中需要将三维点坐标转化为屏幕坐标，进而投射到屏幕上（所以说你被视觉欺骗啦）。当摄像机显示范围过大，最近裁切面太小（Unity默认值是0.3）或者模型偏移过大时，模型点的定位会不准，导致相邻很近的两个面发生相互交错的情况（试想那些点就像跳蚤，你不动它也不动，你若动，它就跳来跳去），进而导致闪烁。解决方法就是对应导致这问题的三种原因进行改进。 



7.	如何对3D人物进行换装。 https://www.cnblogs.com/oldman/articles/2453990.html
9.	人物动作与技能编辑器
10.	骨骼蒙皮和网格动画的区别。
11.	模型和贴图设置优化。
12.	动画优化。(https://blog.uwa4d.com/archives/Sparkle_GPUSkinning.html，http://www.cnblogs.com/murongxiaopifu/p/7250772.html)

