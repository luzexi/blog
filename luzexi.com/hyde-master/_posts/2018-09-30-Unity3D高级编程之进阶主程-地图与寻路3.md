
---
layout: post
status: publish
published: false
title: 《Unity3D高级编程之进阶主程》第十章，地图与寻路(三) 地图编辑器
description: "unity3d 高级编程 主程 地图 navmesh 寻路"
excerpt_separator: ===
tags:
- 书籍著作
- Unity3D
- 前端技术
---

对于任何游戏来说，地图与场景的是比较重要的，特别是对于中大型游戏来说，在地图和场景上花费的时间和精力占去了大部分。而对于大部分游戏类型来说，布置场景，优化场景，甚至为场景写个编辑器是必不可少的，我们通常称他们为‘地图编辑器’。

地图编辑器有哪几种实现方式，该如何实现，顺便讲一讲从哪些方面下手优化场景，我们这节就来讲讲关于地图的事。

### 地图编辑器的实现种类

地图的元素都是以坐标，旋转角度，缩放大小为基准，因此大部分地图编辑都需要有，元素的坐标，角度，缩放大小，至少有这三样的数据记录。其他的数据，也会有包括配置表ID，物件类型，范围大小，脚本名字等，都是为了配合不同游戏系统的需要。

即通常每个元素的数据为：

		class map_unit
		{
			position,
			rotation,
			scale,
			table_id,
			type,
			size,
			function_name,
		}

有了数据就有了数据保存和读取，包括地图数据文件的保存和读取，这两个是最基本的功能。

关于数据的存储与解析，我们在前面的数据协议章节中专门做了详细讲解，这里我们做一些应用，该怎么选择地图数据的数据格式和存储协议。各类协议在这里也能体现其不同的优势。

我们把数据都存储到文件中，用什么协议格式存，就必须用什么协议取，假设我们用最方便的Json方式存储所有数据，并放入文件中，那么我们在读取的时候也需要从Json的协议中协议出每个元素解析到内存中。

假设说我们在众多协议中选择了使用Json协议，那么我们为什么要用Json协议呢，由于Json占用的空间大，解析慢，导致很多人都摒弃它，这样的情况下我们为什么还用它。肯定是因为简单，快速，易上手，只要有点编程知识的人都知道Json的格式，即使不知道也只需要花几分钟就能明白其原理，这对于众多新手来说事福利，而且对于一些技术力量参差不齐的团队（资深只有1，2个，其他都是新人）来说是比较好的选择，大家能很容易达成一个比较高的共识，协作起来也没有太多障碍。

假设说我们使用自定义格式的协议，把每个变量都转换成byte流形式存储，这种形式的存储是最能掌控的，也是最能够节省空间的。因此用自定义协议做存储格式的人，可能非常想要掌控这个存储过程，而不想让其他第三方的插件干扰。不过，自定义协议在使用时也有很大的缺陷，当数据格式变化时，对变化协议格式的适应能力比较弱，虽然也不是没办法，但确实有点代价。

代价是什么呢？要为每个版本的数据格式各自写一个完整的数据读取和存储的程序，每增加一个版本，为了维护旧的数据，都要在原有的数据解析的程序外，增加一个新的数据解析程序。比如，伪代码：

	//


### 场景的制作与优化



### 烘培



10，场景优化技巧
	2.	LOD优化方案。
	3.	合并贴图，合并材质球。
	4.	阴影与优化。 -- 假阴影面片，阴影绘制区域管理
	5.  用Shader顶点变更来替换固定动画，把动画由CPU转移到GPU。

### 6.动态障碍下的寻路

动态障碍在多人RPG在线游戏的上运用的比较多，因为多人同时在同屏玩游戏时有挤压的效果会有更多的竞技感。那么在各种类型的网格模式下，是怎么做到呢？

二维数组中的寻路最容易做动态障碍，因为每个格子都代表了一个寻路点，只要填上一个障碍数据就能

三角网格寻路则使用物理检测碰撞辅助寻路。

1，Navmesh算法。

2，生成Navmesh网格，多层网格数据输出。

http://blianchen.blog.163.com/blog/static/13105629920103211052958/
http://blianchen.blog.163.com/blog/static/13105629920103614613291/
http://blianchen.blog.163.com/blog/static/131056299201037102315211/
http://blianchen.blog.163.com/blog/static/13105629920103811451196/
http://blianchen.blog.163.com/blog/static/13105629920103911258517/
http://blianchen.blog.163.com/blog/static/131056299201031293039882/

3，导入导出，自动生成Navmesh网格，再手工调节。

RecastNavigation-NavMesh生成原理
https://blog.csdn.net/you_lan_hai/article/details/77428858

navmesh高度结构
http://critterai.org/projects/cainav/doc/html/6fb3041b-e9be-4f03-868b-dcac944df19b.htm

关于 Unity NavMesh 数据的导出和使用
http://www.cnblogs.com/yaukey/p/3585226.html

可以用路点+navmesh的形式做图。因为路点消耗少，在城市道路上，在没有怪物的情况下可以做到很少的消耗。而在战斗中则需要整个地面有寻路路线，就需要navmesh的作用。

### 8.人物技能编辑器

人物位移，

特效释放

时间轴

事件机制

9.	人物动作与技能编辑器

