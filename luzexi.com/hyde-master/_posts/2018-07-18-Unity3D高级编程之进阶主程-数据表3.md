---
layout: post
status: publish
published: false
title: 《Unity3D高级编程之进阶主程》第三章，数据表(三)
description: "unity3d 高级编程 主程 数据表 xls Json Xml 多语言"
excerpt_separator: ===
categories:
- 版权著作
- Unity3D
- 前端技术
tags:
- unity3d
- 数据表
---


#《Unity3D高级编程之进阶主程》第三章，数据表(三)

前文介绍了关于数据表的几种形式。[《Unity3D高级编程之进阶主程》第三章，数据表(一)](http://www.luzexi.com/%E7%89%88%E6%9D%83%E8%91%97%E4%BD%9C/unity3d/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/2018/07/09/Unity3D%E9%AB%98%E7%BA%A7%E7%BC%96%E7%A8%8B%E4%B9%8B%E8%BF%9B%E9%98%B6%E4%B8%BB%E7%A8%8B-%E6%95%B0%E6%8D%AE%E8%A1%A81.html)

4.	多语言的文本数据表
项目中文本显示是件比较头疼的事。
很多时候项目起初，文本是写进代码里的，但是当项目中后期，文字又需要由策划来修改和添加，这个导致了大量的程序员的重复工作。所以文字的数据 还是放在表里比较好些，就让改考虑文字内容的人去考虑文字内容吧。

文字放在表里一般都会以Key-Value形式存放。
一般会以Int-String形式存在，或者string-string形式存在。
那么我们来讨论这两种形式吧。
你从数据表里获取文字的方式，你是喜欢以整数为键值还是字符串形式呢？
用整数形式获取，比如string content = GetTextString(12)这种形式。看起来不是很美观，对不，我怎么知道12代表什么？只能意淫下，这个12可能是某个字符串。当代码多了，长了，你很难识别这句话是代表什么，调试起来很麻烦。一个项目基本会有10-30万行代码，到处都是这种形式的字符串获取方式，看了就奔溃。维护性太差。

那么用字符串形式获取，比如string content = GetTextString(“FightWin”)这种形式。会好些吗？
看起来似乎好了些，我知道了我获取的大概是什么内容的字符串。但是问题来，你用一个字符串去获取另一个字符串，那岂不是双份。原本只要存储一个字符串就够了，现在要存两个，因为你用键值字符串去获取内容字符串。

当文字内容很多时，你可能要用很长的字符串去代表一个很长的内容，比如用”BattleSceneFightAllianceWin” 去取”联盟战胜利了”，这种形式的字符串换字符串，导致文字数据表大小变大，不完美。

那么我们来想个更好的方法吧，我们既要用数字去代表文字，又要让键值看起来形象。怎么办？
我倒是有个主意。我们依然在表里填字符串对应字符串，比如上面提到的”BattleSceneFightAllianceWin” 对应”联盟战胜利了”，在导出xls数据文件时，生成一个类文件，专门把Key值按次序写进类中当变量。如下
Class TextKey
{
 BattleSceneFightAllianceWin = 1;
 BattleSceneFightAllianceLose = 2;
}
再把“联盟战胜利了”按次序写入数据文件。这样就可以一一对应了，也就是，第一个变量对应第一个文字。获取文本的方式改为了，string content = GetTextString(TextKey. BattleSceneFightAllianceWin)。

这时文本数据的排列是这样的。如下
联盟战胜利了
联盟战失败了
…

这样就完美了，既解决了用数字做Key不够形象的问题，又解决了字符串做Key太多冗余的问题。

多语言部分怎么处理
简单的处理方式就是做多个表，每个表一个语言。
获取方式可以根据不同语言来获取，
比如string content = GetTextString(Language.Chinese,”win”)
不过每次增加删除都要一一对应，否则一个语言没有改就会报错，调试起来麻烦。

于是我们可以合并表，把一个表里的一个Key对应多个语言的文字内容。如下，
键值，中文，英文，日文，韩文
Win,赢了,Win, 勝った, 이기다
这样就有了规则，第2列是中文，第3列是英文，第4列是日文，第5列是韩文。

好了，做到这里多语言部分就极其方便了。策划和运营人员只要关心语言表里内容和键值是否正确就可以了，其他都可以交给程序员了。
5.优化
*有一键将XLS转换工具，工具具备：方便拆分与合并
*导为lua时可以将默认值去掉，用lua默认值代替
*将字符串移出去单独做一个表，用ID代替，缩小了表，也便于多语言，再把字符串ID写进C#文件，定义为C#变量，便于程序员读取某个字符串，当改变内容时，不会改变ID。
*转为2进制文件存储资源占用量更小
*分散读取，和集中读取，以及预读取