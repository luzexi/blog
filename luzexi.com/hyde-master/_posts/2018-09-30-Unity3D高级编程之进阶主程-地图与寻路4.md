
---
layout: post
status: publish
published: false
title: 《Unity3D高级编程之进阶主程》第十章，地图与寻路(四) 地图的制作与优化
description: "unity3d 高级编程 主程 地图 navmesh 寻路"
excerpt_separator: ===
tags:
- 书籍著作
- Unity3D
- 前端技术
---

### 地图的制作与优化

这里就不说场景制作在美术层面上的技巧了，我们来说说技术层面的。上节把地图编辑器说了一遍，这节就是地图编辑器之上说说，地图的制作与优化。

地图离不开地形，地形其实是地图的关键，地形的制作分为几种：

一种是手动拼接的地形。

手动拼接的地形比较常见，由3D人员制作出来的3D模型作为地面的地形放置在场景中，相当于是一个模型落在场景上一样，只是这个3D模型很可能是有碰撞体的，碰撞体Mesh Collider 可以根据项目的需要进行测试碰撞。也有可能会使用Unity3D内置的地形，也一样相当于一个3D模型放置在场景中，只是我们并不建议使用Unity3D内置的地形罢了。其他3D物体也是用同种方式来放置到场景中，只是放置的手法可能不同，有的可能通过嵌入到prefab的方式，而有的可能通过地图编辑器加入到地图数据文件中，再从加载的地图文件数据的过程中实例化出来。

手动拼接的好处在于地形和地图是可以完全表达美术风格的，地形设计师和场景制作人员能根据自己的喜好和想象中的画面来自由得定制场景，他们可以任意的移动、旋转、缩放，甚至更换、修整、完善等，这能让他们对场景画面的把控有很大的自由度。

能自由发挥当然是好事，但也带来了诸多不可控性，由于场景内物件没有统一的标准，因此在场景制作时常常会大量使用，小块的地形，甚至带有动画的地形，特效，以及半透明效果来增强画面的效果，画面效果增强的同时导致性能急剧降低。

另一种是地图地形的程序拼接方式。

用程序拼接地图，这样所有的地图都由程序而生成了一个或者几个模型的结构，进而铺满整个地面。

这种方式来制作地图最常见的要属2D的RPG游戏了，2D角色扮演类游戏中，几乎整个屏幕的地形都需要用地图编辑器来建立和拼合的，当需要这类地图出现时时，程序会将地图数据加载进来后，对每一块的地图都进行动态的拼合，这样一来，整个地图就只有一个drawcall，因为它只是同一个模型。

2D角色扮演类游戏中，动态拼合整个地图怎么做到的呢，其实很简单。

整个地图就是一个矩形，每个地图的地形方块就是这个大矩形中的一个格子，而每个格子都由2个三角形构成，既然我们能计算出每个方块的位置，我们就能计算每个三角的顶点和位置。

我们知道的是，整个地图有多大，也就是整个矩形有多大，每个方块矩形有多大，也就是每个格子有多大。我们知道有多少格子，有多大的格子，就能计算出，总共有多少个顶点，每个顶点的位置在什么地方，也就能知道三角形该怎么拼接了。

拼接完三角形，再把地图的UV接上去，因为每块地形的图都不一样，所以我们需要在离线时就把所有的地形图都拼成一张图，即以图集的方式存储地图的方块。当我们需要将图接到网格上时，读取那个方块的UV点赋值给顶点就可以了。





地形合并

LOD在场景中发挥的优势

为什么不用Unity3D的静态批处理，而选用手动合并模型。

在手动合并模型外，动态合并模型也是绝佳的方案。

顶点动画代替草和树的摇摆


### 烘培

去除点光源

### 人物动作技能编辑器



10，场景优化技巧
	2.	LOD优化方案。
	3.	合并贴图，合并材质球。
	4.	阴影与优化。 -- 假阴影面片，阴影绘制区域管理
	5.  用Shader顶点变更来替换固定动画，把动画由CPU转移到GPU。

### 6.动态障碍下的寻路

动态障碍在多人RPG在线游戏的上运用的比较多，因为多人同时在同屏玩游戏时有挤压的效果会有更多的竞技感。那么在各种类型的网格模式下，是怎么做到呢？

二维数组中的寻路最容易做动态障碍，因为每个格子都代表了一个寻路点，只要填上一个障碍数据就能

三角网格寻路则使用物理检测碰撞辅助寻路。




RecastNavigation-NavMesh生成原理
https://blog.csdn.net/you_lan_hai/article/details/77428858

navmesh高度结构
http://critterai.org/projects/cainav/doc/html/6fb3041b-e9be-4f03-868b-dcac944df19b.htm

关于 Unity NavMesh 数据的导出和使用
http://www.cnblogs.com/yaukey/p/3585226.html

可以用路点+navmesh的形式做图。因为路点消耗少，在城市道路上，在没有怪物的情况下可以做到很少的消耗。而在战斗中则需要整个地面有寻路路线，就需要navmesh的作用。

### 资源加载的多种方式


### 8.人物技能编辑器

人物位移，

特效释放

时间轴

事件机制

9.	人物动作与技能编辑器
