---
layout: post
status: publish
published: false
title: 《Unity3D高级编程之进阶主程》第七章，渲染管线与图形学(一) - 图形学基础2
description: "unity3d 高级编程 主程 shader 漫反射 镜面反射 自发光 球面反射"
excerpt_separator: ===
tags:
- 书籍著作
- Unity3D
- 前端技术
---

### 理解矩阵表达缩放的几何意义

缩放矩阵和旋转矩阵在几何意义上有着异曲同工之妙，我们同样用二维坐标系来表达缩放矩阵的两个 a,b 向量。

举例来说，二维标准轴的旋转矩阵：

		[1.5,  0]  等  [a]
		[0, 0.75]  于  [b]

我们把 a和b 表现在二维坐标系中，即如图：

		脑补图片

图中a，b两个向量可以形成了一个矩形，我们就假设这个矩形图像表达了a，b向量的缩放关系。当a，b被拉长时，这个矩形图像被也同样被拉长。

其原理为向量与矩阵的乘法，我们知道

		二维向量与二维矩阵相乘 = (x*m11 + y*m21, x*m12 + y*m22)

对于我们这个标准坐标系上的缩放矩阵来说的到的结果是 (1.5*x, 0.75*y)，也就是说

		(x*m11 + y*m21, x*m12 + y*m22) = (x*1.5 + y*0, x*0 + y*0.75) = (1.5*x, 0.75*y)

这个结果表达了，对标准坐标系上的缩放矩阵，在对向量缩放时非常直观易懂，因为除了对角线上的数字，其他位置的数字都是0。

不过这种简单易懂的旋转矩阵，也仅限于标准坐标系中对标准轴的缩放。只有标准坐标系上的缩放计算，是远远满足不了我们的需求的。

那么怎么计算对任意轴方向上的缩放呢？我们来看如下图所示：

		脑补图片

沿 N 方向缩放 v 向量，其实和前一节中绕 N 轴旋转 v 向量也有异曲同工之妙。

我们需要根据我们所知道的推导这个公式，即我们已知v，已知 N，已知缩放因子k (k是一个单纯的数字) ，要求得v’。

可以通过 N 和 v 求得投影 v1，通过 v 和 v1 求得他们的垂直向量 v2，再通过缩放因子 k 求得v1和v2缩放后的向量 v1‘ 和 v2’，最后通过 v1‘ 和 v2’ 求得缩放后的结果向量 v‘，即如下图公式。

		脑补图片

同样的，三维空间中，如果是标准坐标系上缩放，则缩放矩阵可以是很简单的对角线矩阵，即。

		[scale-x, 0, 0]
		[0, scale-y, 0]
		[0, 0, scale-z]

也同样的，这种标准坐标系上的缩放完全满足不了我们的需求，我们需要沿任意向量上的缩放矩阵。

同样的向量，同样的变化，同样的推导，最终结果为：

		脑补图片

最终我们获得了，沿任意方向缩放的矩阵。

结果并不重要，推导的过程才是真正理解矩阵缩放原理的必要过程，我们得知道这个结果是怎么来、原理是怎么样的，怎样理解才能最终通向结果，这才是我们学习的重要目标。

### 平行投影，镜像，切变的理解和几何意义

###### 平行投影

在上述几节中我们了解到了可以用矩阵去缩放任意点和向量，那么如果在缩放时某个轴上的缩放因子为零会变成是什么样的呢，如图所示：

		脑补图片

图中模型所有的点都被挤到了一个平面上，这种在所有点都被拉平至垂直轴或平面上的做法就叫，平行投影，或者也可以叫正交投影。

在标准坐标轴上的平行投影是一个很简单的矩阵，只要把那个投影的轴上的缩放因子置零就可以了。即：

		二维上x轴平行投影

		[1, 0]
		[0, 0]

		二维上y轴平行投影

		[0, 0]
		[0, 1]

		三维上xy平面上的平行投影

		[1, 0, 0]
		[0, 1, 0]
		[0, 0, 0]

		三维上xz平面上的平行投影

		[1, 0, 0]
		[0, 0, 0]
		[0, 0, 1]

		三维上yz平面上的平行投影

		[0, 0, 0]
		[0, 1, 0]
		[0, 0, 1]

只是标准坐标轴上的平行投影还不够用，我们也需要任意直线或任意平面的投影矩阵，不过这次我们不再需要再次计算任意轴上的平行投影，只需要利用缩放矩阵在任意方向或任意轴上的缩放矩阵就可以了，即如下图：

		脑补图片

通过使缩放方向的缩放因子变为零，来获得平行投影矩阵。三维中也是一样，只是在三维中要 N 方向为垂直平面的方向而不是平行于平面的方向。

###### 镜像

镜像更简单了，平行投影是将某个轴上的缩放因子变为零，镜像就是在某个轴上将缩放因子变为负1，这样在缩放时就形成了‘翻转’的局面。如图所示：

		脑补图片

坐标轴的四个象限，右上角的图为正常的图案，左边为对x轴翻转后的图案，下边为y轴翻转后的图案，右下角为x轴和y轴同时翻转的图案。

镜像矩阵也和平行投影矩阵一样，可以用任意缩放矩阵来计算出对任意方向和轴的镜像矩阵，如图所示：

		脑补图片

图中为任意方向的缩放矩阵在当缩放因子为-1时的公式，我们很容易就明白，镜像不过是缩放的一种特殊形式。

###### 切变

切变非常特殊和有趣，它其实是一种坐标系‘扭曲’变换。这种坐标系的‘扭曲’变换将会被运用到对次级空间的坐标平移上。切变的形式如图：

		脑补图片

图中y轴方向的向量中的x坐标被平移了。这是切变在x轴上的变化，我们也可以让切变在y轴上发生变化，如图：

		脑补图片

这两种形式的切变都是通过位移x轴方向上的坐标或y轴方向上的坐标来达到的，其实我们可以理解为对次级维度的坐标系的‘扭曲’。

为什么要这么理解呢，因为它在仿射变化中起到了非常关键的作用，我们将在下面的内容中介绍。

切变的矩阵为：

		二维x轴方向的‘扭曲’
		[1, 0]
		[s, 1]

		二维y轴方向的‘扭曲’
		[1, s]
		[0, 1]

		三维x,y轴方向的的切变
		[1, 0, 0]
		[0, 1, 0]
		[s, t, 1]

		三维x,z轴方向的切变
		[1, 0, 0]
		[s, 1, t]
		[0, 0, 1]

		三维y,z轴方向的切变
		[1, s, t]
		[0, 1, 0]
		[0, 0, 1]





### 四元组的意义

### 空间计算

平面的表达方式，球体的表达方式，AABB包围盒的表达方式

点到平面的距离，点到平面的向量

2D线上最近的点

平面上最近的点

圆或球体上最近的点

AABB上最近的点

### 图形相交检测

线段相交检测

射线与平面相交检测

AABB与平面相交检测

射线与圆球的相交检测

两个圆球的相交检测

球与AABB的相交检测

射线与三角形的相交检测

射线与AABB的相交检测

两个AABB的相交检测

### 网格的表达与渲染方式



参考资料：

《3D数学基础:图形与游戏开发》






