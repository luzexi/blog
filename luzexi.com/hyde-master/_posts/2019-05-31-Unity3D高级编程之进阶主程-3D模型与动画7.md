---
layout: post
status: publish
published: false
title: 《Unity3D高级编程之进阶主程》第五章，3D模型与动画(四) - 3D模型的变与换4
description: "unity3d 高级编程 主程 "
excerpt_separator: ===
tags:
- 书籍著作
- Unity3D
- 前端技术
---

前面讲解了些骨骼动画的基础知识，我们在基础知识上可以理解骨骼动画的原理。在骨骼原理之后，我们又对人物模型动画的换皮换装的原理了解了一下，因为有了骨骼动画的基础知识支撑，对换装换皮的方法和技巧上理解起来就更加的清晰了。

其实看一遍是不够的，要看很多遍，而且要边想边看边实践，这样才有效果。要不怎么说理论这东西用处不够大呢，如果只有理论，那么这就是纸上谈兵，解决不了实际问题，反过来也是一样，只有实践则无法彻底了解原理和机制，我们就无法精进，总是觉得有什么东西被蒙在鼓里，运用起来不能得心应手。

有原理和实践，也还是不行，还得多思考多举一反三。要彻底理解一个知识点，真的难。在这条学习的道路上我们不能放弃，即使放弃了，也要想着什么时候能重新捡回来。人无完人，大家都一样，所有人都要经历失败，放弃，再重新捡起来，再失败，再放弃，再重新捡起来的过程，谁能更快的重新捡起来，就成了取胜的关键了，失败是必然的，就看谁能先重新站起来，再失败也是必然的，就看谁能一次次失败后还能站得住。

本篇我们讲述在骨骼动画原理之上，做些更高级的技巧，这些技巧都是基于上篇和上上篇的基础知识之上的。我们再来简单的复述下模型与动画的原理：

网格主要由顶点，三角形索引数组，uv这三个基础数据组成，也可以有顶点的法线和颜色数据。其中uv用于贴图，法线用于展示凹凸效果，顶点颜色则有其他多种用途。

蒙皮骨骼动画，也就是SkinnedMeshRenderer，除了有这些网格数据外，又多了骨骼点和骨骼权重数据。骨骼点，是以父子或兄弟的关系相连的节点，它在Unity3D里的表象就相当于许多GameObject相互挂载并放在根节点下，除了这些看得见的GameObject节点外，骨骼点还需要旋转矩阵bindPoses，它主要是为了当父节点旋转移位时能更快的计算得到自身位移和旋转的结果矩阵，每个矩阵都是其父节点矩阵相乘所得到的结果。最后是骨骼权重数据，原来每个顶点都有自己的顶点数据，现在在顶点数据之上又多了些数据来表达被哪些骨骼的影响权重值。

用最简洁的语言回顾了一下基础的知识点，下面我们就开始一些更高级的技巧，这些技巧都是基于这些原理和基础知识之上的。

### 6.捏脸

捏脸是一种行为方式，用以表达对对方的喜爱之情或对其某行为作出惩罚。网络游戏中泛指对虚拟角色样貌进行DIY的数据操作。

捏脸看起来像是很复杂的技巧，在我们剖析一下后就会觉得也不难么。

###### 首先，捏脸最重要的部分就是换部位。

角色身上可以替换的部位有，不同形状的头，不同形状的上身，不同形状的腿，不同形状的脚，不同形状的手臂，不同形状的手，不同形状的眉毛，其实还可以细分到更多，比如嘴，耳朵，胸，头发等，这些部件都可以从整体模型中拆分出来，单独成立一个模型，选出来后再拼装到整体模型上去。

这样一来，我们就有了很多个模型部件是可以替换的，在捏脸时可以选择不同的形状的部件来进行替换。

替换的过程其实就是上篇我们讲到的换装的过程，我们再来简单回顾下。

我们必须所有模型都使用同一套骨骼，把骨骼以SkinnedMeshRenderer的方式实例化出来，并挂上动画组件和动画文件，当播放动画时就可以看到骨骼随着动画数据而动起来了。

但此时还没有任何模型展示，我们把选中的部件模型以SkinnedMeshRenderer的形式实例化出来，并挂载在骨骼实例下，挂载在骨骼实例下的部件模型只是静止的不会动的模型，虽然其自身有顶点的骨骼的权重数据，但没有骨骼点绑定是无法计算出骨骼变化后的模型变化的。

因此我们再把骨骼实例里的骨骼点数据赋给这些实例化出来的模型部件，让他们能根据骨骼的变化用自身的骨骼权重数据来计算自身的网格变化情况。

做完这些操作后，

换图

换模型

骨骼移动，旋转，缩放

改变Mesh凹凸形状

### 7.动画优化

编写Shader的顶点动画代替蒙皮动画

将每帧的网格数据导出到图片，在Shader中让GPU通过图片里的数据来改变顶点网格。

LOD，骨骼LOD，网格LOD

Bake每帧的模型网格，然后用DrawMesh绘制每一帧，用内存换cpu


### 8.人物技能编辑器

人物位移，

特效释放

时间轴

事件机制


### 如何对3D模型表面进行实时变更。(https://zhuanlan.zhihu.com/p/28471808 捏脸，骨骼点移动，旋转，缩放，Mesh大小差值实时生成)


9.	人物动作与技能编辑器
11.	模型和贴图设置优化。
12.	动画优化。(https://blog.uwa4d.com/archives/Sparkle_GPUSkinning.html，http://www.cnblogs.com/murongxiaopifu/p/7250772.html)

