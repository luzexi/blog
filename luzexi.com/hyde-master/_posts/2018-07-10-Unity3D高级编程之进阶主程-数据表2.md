---
layout: post
status: publish
published: false
title: 《Unity3D高级编程之进阶主程》第三章，数据表(二)
description: "unity3d 高级编程 主程 数据表 xls Json Xml 多语言"
excerpt_separator: ===
categories:
- 版权著作
- Unity3D
- 前端技术
tags:
- unity3d
- 数据表
---


《Unity3D高级编程之进阶主程》第三章，数据表(二)


2.	有哪几种制作数据表形式
XLS是大部分数值策划选择用的填数工具。

所以XLS转什么格式就需要选择了。

最简单的就是直接复制黏贴到txt文件作为游戏数据了。
这种方式最简单快捷，任何人都能干，但问题就是当多个xls转化为文件数据时，你就麻烦了，每次都要手动复制粘贴一遍。而且手动导入后你还要想想，是不是复制粘贴错了。以前我为了DEMO图快，加快进度，也这么干。但好几次查些莫名奇妙的数据表错误，都是因为人脑是有极限的，时常会因为重复劳动太多次而出错。

有比较简单的直接XLS手动另存为导出CSV，就有了CSV的一个规范。
这样既有了规范，又不怕复制粘贴错误，但还是有很多问题，比如多个文件时，你的重复劳动还是很多。你大可以写个程序，读取xls里的数据，然后生成数据文件，给xls一个规范，比如第一行作废，从第二行开始读取，直到没有数据可读结束。这样你就不用再手动重复劳动了，人脑重复劳动最容易疲惫了，避免重复劳动是我们程序员的第一要事。

有了CSV就有了读取和填数据的规范。
当然CSV这个格式不是很好，他用tab隔开或逗号隔开每一列，但有时我们需要用tab或逗号隔开一个单位里的数据，所以CSV也不再满足需求了。

于是有些人用json，倒腾下xls就可以自动导出json了，当然这中间你可能会对一个单元里多个数组成数据的形式进行一下规范再导出。然后程序去读json文件后进行解析。解析可以用simplejson或者其他的库，网上很多。

字符串形式在数据多的时候，文件容量稍微有点大，所以为了减少容量，就用了2进制存储数据，于是就有了写个程序将XLS导为2进制文件形式。

当然数据比特流形式的存储数据并不一定是最佳方案，我是使用主义者，我相信任何方式在不同环境下都有不同优势。并不一定说，csv就劣质，比特流就一定高级，项目中得不偿失的例子比比皆是，浪费了大量的工作时间，却只实现了一个集费时间，又不好用的工具，是时常发生的事。

3.	数据表制作关键是什么
用什么形式的文件作为数据表并不重要，CSV也照样能把游戏跑得很好。这些技术并不决定游戏的性能会怎么样，只要你喜欢，什么形式都可以。很多时候，我们在选定数据存储规则时，大都选择的是自己熟悉，并且团队任何的方式。因为这能给我们带来很大的便捷性，也加快了开发速度，让团队不用这么痛苦并且浪费时间去适应新的规则。

关键是数据表是连接策划与其他部门的桥梁，所以你在做的时候需要考虑体验因素。如何让策划在配置数据表的时候能够有更好的体验就成了关键。所以好用是关键。

一键转化XLS到其他格式是一个比较人性化的工具，不需要人工手动去转化，通过工具就能搞定，只要数值策划按照你们双方约定的规则就行。这能大大提高数值策划与程序的协调性，一个系统，一个模块，需要什么数值，什么类型的数值，表要怎么建立，在你们约定的填表规则上，建立，读取，转化，变得轻而易举。

再深入点，就有一键导出所有XLS配置表后将数据拷贝到程序指定的项目工程目录里。
程序的转移数据文件的工作也加快了，把导出后的表直接拷贝到工程目录，直接可以调试新的数据了。

再深入一点，策划可以自定义导出哪个表文件，表里的哪个工作簿，这样策划可以自主选择和自主增加表的导出内容。
一般我们在写程序指定导出哪个表时，会预留几个参数，这个参数是指向某个需要导出的文件的，以及需要导出sheet。那么在命令行里，执行这个程序并且后面跟上参与就能导出数据。
但是批处理写命令行也好，shell写命令行也好，毕竟还是程序级别的。策划并不能很好的控制对表的导出内容的增加和修改。
比如我需要新增一个表，或者修改某个表的文件名，或者修改导出某个表文件里的sheet，这项工作还是需要修改命令行的，或者说修改批处理文件，或shell文件的。策划并不会改，或者说并且这种命令形式并不直观。

所以我们可以增加一个表，表里面填有具体要导出哪些XLS文件里的哪个sheet，这些sheet的数据导出的文件名叫什么。这样策划就可以自行定制，我们需要用哪些XLS里的哪些sheet，可以自行增删改，可以完全自给自足了。

再深入一点，用程序生成一个程序变量定义与每个数据表列名对应代码，将每个要导出的sheet里的头行的列名作为列名写入程序变量定义类中，以方便程序在读取数据表时，列名与数据表对齐，无形中校验做好了。程序不再需要知道策划要的数据是第几列，只要策划给一个列明就知道他指的是这个sheet里的哪一列。这样一来，我们读取表数据后，取哪一列的操作，可以直接用前面生成变量来引用，不用再去查看是第几列了。

所有这些途径都是为了更好的加强策划与程序之间的桥梁，让团队能够更有效率得将数值这块做的更好。无论是项目在改进中的阶段，还是开始阶段。
4.	多语言的文本数据表
项目中文本显示是件比较头疼的事。
很多时候项目起初，文本是写进代码里的，但是当项目中后期，文字又需要由策划来修改和添加，这个导致了大量的程序员的重复工作。所以文字的数据 还是放在表里比较好些，就让改考虑文字内容的人去考虑文字内容吧。

文字放在表里一般都会以Key-Value形式存放。
一般会以Int-String形式存在，或者string-string形式存在。
那么我们来讨论这两种形式吧。
你从数据表里获取文字的方式，你是喜欢以整数为键值还是字符串形式呢？
用整数形式获取，比如string content = GetTextString(12)这种形式。看起来不是很美观，对不，我怎么知道12代表什么？只能意淫下，这个12可能是某个字符串。当代码多了，长了，你很难识别这句话是代表什么，调试起来很麻烦。一个项目基本会有10-30万行代码，到处都是这种形式的字符串获取方式，看了就奔溃。维护性太差。

那么用字符串形式获取，比如string content = GetTextString(“FightWin”)这种形式。会好些吗？
看起来似乎好了些，我知道了我获取的大概是什么内容的字符串。但是问题来，你用一个字符串去获取另一个字符串，那岂不是双份。原本只要存储一个字符串就够了，现在要存两个，因为你用键值字符串去获取内容字符串。

当文字内容很多时，你可能要用很长的字符串去代表一个很长的内容，比如用”BattleSceneFightAllianceWin” 去取”联盟战胜利了”，这种形式的字符串换字符串，导致文字数据表大小变大，不完美。

那么我们来想个更好的方法吧，我们既要用数字去代表文字，又要让键值看起来形象。怎么办？
我倒是有个主意。我们依然在表里填字符串对应字符串，比如上面提到的”BattleSceneFightAllianceWin” 对应”联盟战胜利了”，在导出xls数据文件时，生成一个类文件，专门把Key值按次序写进类中当变量。如下
Class TextKey
{
 BattleSceneFightAllianceWin = 1;
 BattleSceneFightAllianceLose = 2;
}
再把“联盟战胜利了”按次序写入数据文件。这样就可以一一对应了，也就是，第一个变量对应第一个文字。获取文本的方式改为了，string content = GetTextString(TextKey. BattleSceneFightAllianceWin)。

这时文本数据的排列是这样的。如下
联盟战胜利了
联盟战失败了
…

这样就完美了，既解决了用数字做Key不够形象的问题，又解决了字符串做Key太多冗余的问题。

多语言部分怎么处理
简单的处理方式就是做多个表，每个表一个语言。
获取方式可以根据不同语言来获取，
比如string content = GetTextString(Language.Chinese,”win”)
不过每次增加删除都要一一对应，否则一个语言没有改就会报错，调试起来麻烦。

于是我们可以合并表，把一个表里的一个Key对应多个语言的文字内容。如下，
键值，中文，英文，日文，韩文
Win,赢了,Win, 勝った, 이기다
这样就有了规则，第2列是中文，第3列是英文，第4列是日文，第5列是韩文。

好了，做到这里多语言部分就极其方便了。策划和运营人员只要关心语言表里内容和键值是否正确就可以了，其他都可以交给程序员了。
5.优化
*有一键将XLS转换工具，工具具备：方便拆分与合并
*导为lua时可以将默认值去掉，用lua默认值代替
*将字符串移出去单独做一个表，用ID代替，缩小了表，也便于多语言，再把字符串ID写进C#文件，定义为C#变量，便于程序员读取某个字符串，当改变内容时，不会改变ID。
*转为2进制文件存储资源占用量更小
*分散读取，和集中读取，以及预读取