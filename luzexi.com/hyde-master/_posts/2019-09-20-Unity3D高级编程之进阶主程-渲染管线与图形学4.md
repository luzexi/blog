---
layout: post
status: publish
published: false
title: 《Unity3D高级编程之进阶主程》第七章，渲染管线与图形学(二) - 渲染管线1
description: "unity3d 高级编程 主程 shader 漫反射 镜面反射 自发光 球面反射"
excerpt_separator: ===
tags:
- 书籍著作
- Unity3D
- 前端技术
---

计算机的世界里其实是很纯粹的，没有什么高深的技术，无非就是进程、线程、内存、硬盘、CPU。

在现代社会的实际编程中，很多时候引擎或者框架帮我们屏蔽了底层上的操作程序员只需要将所有精力放在上层应用就可以了，所以算法很多时候成了重点，这是符合社会进步需求的，我们需要站在巨人的肩膀上才能走得比巨人更快更远。

Unity3D就是帮助我们快速建立程序结构的好引擎，有了Unity3D我们才能在较低门槛的情况下，创造出自己的想法和创意，让’我‘里面有的内在才能快速和有效的得到放大。

除了进程、线程、内存、硬盘、CPU这些通常我们程序员在编程时都要考虑的因素外，对于我们前端程序员来说又多了一个GPU的因素，因此我们需要学习和考虑的问题更加多一些也更加复杂一些，Unity3D虽然封装了所有引擎需要的功能但我们还是必须要了解渲染管线是如何处理渲染数据并最终渲染要屏幕上的。

### OpenGL、DirectX究竟是什么

OpenGL 和 DirectX 其实是一回事，它们都是图形渲染的应用程序编程接口，它们都是一种可以对图形硬件设备特性进行访问的软件库。它们的区别只是接口不一样，并且，分别由不同的两个开发群体开发出来的两套程序。

OpenGL是由SGI(Silicon Graphics 美国硅图公司)开发的，而DirectX是由微软开发的，为什么两家公司要做同样的事，最后导致这个世界更加复杂了呢。我们可以想象在当初，还没有形成统一的硬件渲染接口时，各家公司的编程方式有多混乱，情况有多复杂，竞争有多激烈，也只有这种严峻的情况下才使得两家公司为了各自的利益，一直在不断维护和升级着各自的驱动接口直到今天。

幸运的是Unity3D已经帮我们封装好了OpenGL和DirectX的接口，我们无需关心到底是调用OpenGL还是DirectX。

###### OpenGL究竟处在哪个位置

Unity3D通过调用 OpenGL 来渲染图像，OpenGL 定义各种标准接口就是为了让像 Unity3D 这样的应用程序在面对不同类型的显卡硬件时可以忽略它们，也就是说由于 OpenGL 的存在，Unity3D完全不需要去关心硬件到底是哪家生产厂商生产的，它们的驱动是什么，OpenGL在标准接口中已经适配了硬件厂商的驱动程序。

当Unity3D调用OpenGL时，OpenGL就会去检查显卡驱动程序里是否有该功能，如果有就会调用，如果是那些比较特殊的渲染接口，有些硬件驱动是没有的则不调用。

如果把GPU硬件看做是最底层的那个模块的话，显卡驱动就是在硬件之上的模块，是用机器语言调用硬件的那个部分。

显然OpenGL是在驱动程序之上的，我们可以把它看做是适配不同驱动程序的中间件，只是这个中间比较强大，实现了我们现在所用的渲染管线。如图图：

![opengl](/assets/book/7/render-pipeline1.png)

上图中很清晰的表达OpenGL所处的位置，应用程序(如Unity3D)向OpenGL发送渲染指令，告诉OpenGL我的某个模型数据需要渲染，OpenGL经过渲染管线的处理再发送指令给显卡驱动程序，显卡驱动程序翻译指令为机器码后，将指令机器码发送到GPU，GPU先从内存中获得数据再做处理。

当然这里GPU不只会处理一次，OpenGL会通过显卡驱动发送很多次指令给GPU，让它处理各种各样的操作，每次指令都有可能不一样，经过一系列的处理过程最终 OpenGL 发送GPU说’好了，现在都处理完了，向屏幕展示我们的画面吧‘，这时GPU才向屏幕输出最终画面。

### 究竟渲染管线是什么

上面所说的 OpenGL 通过驱动程序向 GPU 发送很多个指令，这一系列指令合起来，其实就是渲染管线的整个过程。

从严肃的理论描述来说渲染管线是：一系列数据处理的过程，这个过程最终的目的是将应用程序的数据转换到最终渲染的图像输出到屏幕。

我们可以再白话一点。







