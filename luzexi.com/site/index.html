<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
  <meta content="" name="description">


  <title>
    
      技术人生 &middot; www.luzexi.com
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/hyde.css?version=20180701">
  <!-- <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface"> -->

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-144-precomposed.png">
                                 <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body>

  	<div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <h1>
        <a href="/">
          技术人生
        </a>
      </h1>
      <p class="lead">漫漫人生,记录点滴技术,始于2013</p>
    </div>

    <nav class="sidebar-nav">
      <a class="sidebar-nav-item active" href="/">Home</a>

      

      <a class="sidebar-nav-item" href="/书籍著作/index.html">书籍著作</a>
      <a class="sidebar-nav-item" href="/Unity3D/index.html">Unity3D</a>
      <a class="sidebar-nav-item" href="/游戏通用模块/index.html">游戏通用模块</a>
      <a class="sidebar-nav-item" href="/前端技术/index.html">前端技术</a>
      <a class="sidebar-nav-item" href="/后端技术/index.html">后端技术</a>
      <a class="sidebar-nav-item" href="/其他技术/index.html">其他技术</a>
      <a class="sidebar-nav-item" href="/金融投资/index.html">金融投资</a>
      <a class="sidebar-nav-item" href="/life/index.html">Life</a>

      
      
        
          
        
      
        
          
            <a class="sidebar-nav-item" href="/about.html">About Me</a>
          
        
      
        
      
        
          
            <a class="sidebar-nav-item" href="/engineer-shopping.html">程序员必需品</a>
          
        
      
        
      
        
          
            <a class="sidebar-nav-item" href="/friendlink.html">友情链接</a>
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
      
        
      
      
      <a class="sidebar-nav-item" href="https://github.com/luzexi">GitHub project</a>
      <a href="http://www.luzexi.com/assets/feed.xml">RSS feed</a>
      <!-- <span class="sidebar-nav-item">Currently v2.1.0</span> -->
    </nav>

    <p>&copy; 2018. All rights reserved.</p>
    <p>浙ICP备13028172号-1</p>
  </div>
</div>


    <div class="content container">
      <div class="posts">
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2018/08/08/Unity3D%E9%AB%98%E7%BA%A7%E7%BC%96%E7%A8%8B%E4%B9%8B%E8%BF%9B%E9%98%B6%E4%B8%BB%E7%A8%8B-Shader5.html">
        《Unity3D高级编程之进阶主程》第七章，Shader(五) - Pass(二)
      </a>
    </h1>

    <span class="post-date">08 Aug 2018</span>

    <h3>Render State Command渲染状态指令详解</h3>

<p>Render State Command 是渲染状态的指令，它在Pass和SubShader都有效，放在Pass就只在当前Pass里有效，放在SubShader中则是多个Pass的共同状态。</p>

<p>不过不是所有的Render State都可以成为共同拥有的渲染状态的，有些Render State只在Pass中有效，而另一些则可以成为共同渲染状态。</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2018/08/08/Unity3D%E9%AB%98%E7%BA%A7%E7%BC%96%E7%A8%8B%E4%B9%8B%E8%BF%9B%E9%98%B6%E4%B8%BB%E7%A8%8B-Shader4.html">
        《Unity3D高级编程之进阶主程》第七章，Shader(四) - Pass(一)
      </a>
    </h1>

    <span class="post-date">08 Aug 2018</span>

    <h3>Pass</h3>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2018/08/08/Unity3D%E9%AB%98%E7%BA%A7%E7%BC%96%E7%A8%8B%E4%B9%8B%E8%BF%9B%E9%98%B6%E4%B8%BB%E7%A8%8B-Shader3.html">
        《Unity3D高级编程之进阶主程》第七章，Shader(三) - 渲染管道
      </a>
    </h1>

    <span class="post-date">08 Aug 2018</span>

    <h3>SubShader模块</h3>

<p>SubShader相当于子Shader的意思，SubShader在Shader中可以有很多个，每个SubShader都可以针对一种设备，但不是所有SubShader都会被采用。当Unity去展示一个模型时，会从第一个SubShader开始寻找是否匹配当前的设备，如果不匹配则与下一个SubShader继续匹配，直到找到能够匹配该设备为止。如果所有的SubShader都没有匹配上，则会使用 Fallback 标签的Shader。</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2018/08/07/Unity3D%E9%AB%98%E7%BA%A7%E7%BC%96%E7%A8%8B%E4%B9%8B%E8%BF%9B%E9%98%B6%E4%B8%BB%E7%A8%8B-%E7%BD%91%E7%BB%9C%E5%B1%823.html">
        《Unity3D高级编程之进阶主程》第六章，网络层(三) - 实现UDP
      </a>
    </h1>

    <span class="post-date">07 Aug 2018</span>

    <h3>实现UDP</h3>

<p>在前面介绍了如何实现TCP socket，下面要介绍下UDP的实现方式。</p>

<p>其实两者都是长链接的方式，很多地方都有相识之处，比如两者都需要连接和断开事件支撑，都需要做发送和接收队列缓存，都需要定义数据包协议格式，都需要加密和校验。</p>

<p>我们来说说TCP有而UDP没有的部分，以及需要我们在UDP上实现的功能。UDP和TCP相比，UDP基本就是TCP的阉割版本，很多TCP有的功能UDP都没有。相同的地方有，都是异步发送和接收，都需要多线程操作，发送和接收都需要缓冲队列，并且发送数据时都需要合并数据包。TCP有而UDP没有的地方有，UDP不会自己校验重发，丢包概率大，数据包接收顺序不确定，而且UDP本身没有连接断开检测机制，也没有连接确认机制。</p>

<p>所以直接使用UDP来做网络连接，会遇到巨大的问题，可以说直接使用而不加修饰，不确定性太大基本用不了UDP。</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2018/08/07/Unity3D%E9%AB%98%E7%BA%A7%E7%BC%96%E7%A8%8B%E4%B9%8B%E8%BF%9B%E9%98%B6%E4%B8%BB%E7%A8%8B-%E7%BD%91%E7%BB%9C%E5%B1%822.html">
        《Unity3D高级编程之进阶主程》第六章，网络层(二) - 实现TCP
      </a>
    </h1>

    <span class="post-date">07 Aug 2018</span>

    <h3>实现TCP长连接。</h3>

<p>我们先从整体出发，列一下Unity3D实现TCP连接需要的实现哪些方面：</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>    1， 建立连接

    2， 断线检测

    3， 网络协议

    4， 发送和接收队列缓冲

    5， 发送数据合并

    6， 线程死锁策略
</code></pre></div>
  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2018/08/07/Unity3D%E9%AB%98%E7%BA%A7%E7%BC%96%E7%A8%8B%E4%B9%8B%E8%BF%9B%E9%98%B6%E4%B8%BB%E7%A8%8B-Shader2.html">
        《Unity3D高级编程之进阶主程》第七章，Shader(二) - Property
      </a>
    </h1>

    <span class="post-date">07 Aug 2018</span>

    <h3>编写Shader的几种方式</h3>

<p>着色器部分的编写是客户端的精髓，如果说架构表现了逻辑整合能力，算法展现了数学能力，那么着色器编写展现了表现能力，在游戏项目中三者缺一不可，特别是作为主程或者说资深的U3D人员来说是极其重要的。</p>

<p>Unity3D使用了自己创造的语言命名为ShaderLab来编写图形Shader。在ShaderLab里模拟了类似CgFX和Direct3D Effects(.FX)的语言，从而可以编写绝大部分的图形渲染材质。</p>

<p>ShaderLab编写的Shader属性会在Unity的材质球编辑器中显示，ShaderLab可以实现基于多种目标硬件的能力，并且每个ShaderLab完全能够编写图形硬件渲染状态，以及使用vertex和fragment编程。Shader的编写是基于高级Cg/HLSL编程语言基础上的。</p>

<p>下面几节中，我们会详细的讲解，如何用ShaderLab去写Unity Shader，包括Surface Shader, fixed-function Shader,vertex和fragment的Shader编程。</p>

<p>Shader编程需要一些基本的OpenGL或Direct3D渲染状态的知识，还有一些HLSL,Cg,GLSL或者Metal Shader编程语言的知识。如果并没有掌握也没有关系，我们将以通俗易懂的语言解释大部分的图形渲染知识。</p>

<p>编写Unity Shader的几种形式：</p>

<h6>1，fixed-function，这种形式的Shader使用了Unity自己编制的比较简单的图形语言来编写Shader。</h6>

<p>编写完毕后在导入和编译时，Unity内部会将这个fixed-function形式的代码，转化成vertex和fragment编程形式。</p>

<p>因为fixed-function形式编写起来比较简单易懂，所以一些简单的Shader可以用fixed-function来编写，可以节省很多学习底层图形学的时间也增加了不少效率。缺点是，功能并不是很全，复杂一点的或者说个性化点的Shader就需要用其他的方式实现。</p>

<h6>2，Surface shaders 是Unity建立的一种新的Shader编程方式，目的是让Shader编程更加简单。</h6>

<p>在Surface Shader里没有任何的自定义语言，贴图，或者变量。它会生成所有你需要手写的代码，让你专注于编写渲染部分的规则，其中一个特色是Surface Shader不需要写Pass，它会自动帮你编译成为多个你需要的多个Pass。</p>

<p>Surface Shader编译器最终会将所有代码转换成vertex-fragment类型的Shader。</p>

<h6>3，vertex and fragment shaders是ShaderLab Shader包含的几种不同的编写方式中最最底层的编码方式，它使用的HLSL语言编程，我们称之为底层硬件着色器着色编程。</h6>

<p>使用vertex-fragment方式只是ShaderLab的理念中的其中一部分，fixed-function和suface都是其理念的一部分，并不一定说要使用vertex-fragment底层的才好，其他方式也同样能帮助你节省很多时间。</p>

<p>比如你想对灯光作用进行着色编程，你完全可以使用Surface Shader去实现你的想法，如果只想对贴图上色和混合，你使用fixed-function更为简单省事，如果你想对顶点颜色，或对顶点坐标进行更改，或者片元的着色需要更改等一些更复杂的图形操作，那你就需要使用vertex-fragment Shader进行编程。</p>

<p>针对不同的复杂度，不同的项目，不同领域的着色渲染，我们完全可以选择不同的方式来编写Shader。</p>

<p>无论你用哪种方式编写Shader，其实都是在ShaderLab语言结构下的，前面说过ShaderLab是Unity指定的组织Shader的官方编程语言，所以在Unity编写Shader首先要学会如何使用ShaderLab。</p>

<p>了解了基本的ShaderLab语言结构和语法，再去学习surface和vertex-fragment就会相对比较容易。而fixed-function是完全基于ShaderLab语法结构编写的，所以fixed-function形式的写法完全可以参照ShaderLab的使用方法来编写。</p>

<h3>ShaderLab语法与参数详解</h3>

<p>我们需要着重介绍下ShaderLab的格式，Unity3D中所有的Shader编程方式都是基于ShaderLab的，因此ShaderLab语法是基础。</p>

<h6>Shader的开头</h6>

<p>“Shader” 是Shader文件的根命令。每个文件必须定义一个且只有一个Shade命令，它可以定义一个Shader的名字，是一个Shader的开头。</p>

<p>在“Shader”里面你才可以表达有哪些属性，有哪些渲染模式被开启和关闭，有多少条渲染管线等等那些你需要的定义以及变化。</p>

<p>格式：</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>    Shader “name”
    {
        [Properties属性]
        Subshaders
        [Fallback]
        [CustomEditor]
    }
</code></pre></div>
<p>定义了一个Shader后，Shader的Name就会出现在Unity编辑器的材质球视窗的Shader列表里，可供你选择。Shader中定义的属性，供Shader计算使用，并且这些属性会显示在材质球编辑器的视窗中。</p>

<script type="text/javascript">
    if (/(iPhone|iPad|iPod|iOS|Android)/i.test(navigator.userAgent))
    { //移动端
        /*mobile-20:5*/
        var cpro_id = "u3493987";
        document.write("\<script type=\"text\/javascript\" src=\"//cpro.baidustatic.com/cpro/ui/cm.js\"\>\<\/script\>");
    }
    else
    {
         /*700*200信息流*/
        var cpro_id = "u3469788";
        document.write("\<script type=\"text/javascript\" src=\"//cpro.baidustatic.com/cpro/ui/c.js\"\>\<\/script\>");
    }
</script>

<h6>Properties属性</h6>

<p>Shader中可以自己定义一些属性用来在后面的渲染计算中使用。比如数字，颜色，方向，坐标，贴图。</p>

<p>Properties格式：</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>    Properties
    {
        PropertyName1 (“display name名字”，type类型) = value默认值
        PropertyName2 (“display name名字”，type类型) = value默认值
        PropertyName3 (“display name名字”，type类型) = value默认值
        …
    }
</code></pre></div>
<p>Properties属性格式需要中括号框起来，大括号内都是属性的详细说明。</p>

<p>其中PropertyName和 display name是不一样的，Property Name是属性的真正名字，可以用来通过材质球才程序中更改和赋值，或者在后面的渲染计算中使用。而display name 只是在编辑器中显示该属性名的名字，没有其他用途。</p>

<p>下面举例来说明各种类型的书写方式。</p>

<p>数字</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>    Name属性名 (“display name显示名”, Range(最小值,最大值)) = 默认值

    上述属性块定义了一个数字，起始有一个默认值，该值可以在最大值和最小值范围内，不得超出最大和最小值，定义后可以在材质球的编辑器中滑动的来选择值的大小。

    Name属性名 (“display name显示名”, Float) = 默认值

    上述属性块定义了一个浮点数数值，具有一个默认值，同样定义后，可以在材质球的编辑器中输入浮点数来重新赋值。

    Name属性名 (“display name显示名”, Int) = 默认值

    上述属性块定义了一个整数数值，具有一个默认值，同样定义后，可以在材质球的编辑器中输入整数来重新赋值。
</code></pre></div>
<p>颜色</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>    Name属性名 (“display name显示名”, Color) = (R,G,B,A)

    上述属性块定义了一个颜色，具有一个RGBA(红，绿，黑，alpha)的默认值，定义后可以在材质球的编辑器中选择一个颜色来重新赋值。
</code></pre></div>
<p>方向和坐标</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>    Name属性名 (“display name显示名”, Vector) = (0,0,0,0)

    上述属性块定义了一个方向或者坐标，具有一个默认值，定义后可以在材质球的编辑器中填写4个值来重新赋值。
</code></pre></div>
<p>贴图</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>    Name属性名 (“display name显示名”, 2D) = “white” {}

    上述属性块定义了一个2D贴图，具有一个纯白色的默认贴图，定义后可以在材质球的编辑器中选择新的贴图来重新赋值。

    Name属性名 (“display name显示名”, Cube) = {}

    上述属性块定义了一个Cube镜面盒子，空的默认值，定义后可以在材质球的编辑器中选择新的Cube镜面盒子来重新赋值。

    Name属性名 (“display name显示名”, 3D) = “white” {}

    上述属性块定义了一个3D贴图，具有一个纯白色的默认贴图，定义后可以在材质球的编辑器中选择新的3D贴图来重新赋值。这个3D Texture不是普通的3D模型的贴图，而是图像后处理形成的3D颜色校正效果贴图。3D Texture由脚本或者着色器产生，而非手绘制造的。可参考Unity API中的Texture3D类。
</code></pre></div>
<p>综合上面的表述，我们可以制作一个全属性Properties例子。</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Properties</span>
<span class="o">{</span>
    <span class="n">_Scale</span> <span class="o">(</span><span class="s">&quot;Scale&quot;</span><span class="o">,</span> <span class="n">Range</span> <span class="o">(</span><span class="mf">0.02</span><span class="o">,</span><span class="mf">0.15</span><span class="o">))</span> <span class="o">=</span> <span class="mf">0.07</span>
    <span class="n">_PahLength</span><span class="o">(</span><span class="s">&quot;Path Length&quot;</span><span class="o">,</span> <span class="n">Float</span><span class="o">)</span> <span class="o">=</span> <span class="mf">1.5</span>
    <span class="n">_OrderNumber</span><span class="o">(</span><span class="s">&quot;Order Number&quot;</span><span class="o">,</span> <span class="n">Int</span><span class="o">)</span> <span class="o">=</span> <span class="mi">53</span>
    <span class="n">_RefrColor</span> <span class="o">(</span><span class="s">&quot;Refraction color&quot;</span><span class="o">,</span> <span class="n">Color</span><span class="o">)</span> <span class="o">=</span> <span class="o">(</span><span class="mf">0.34</span><span class="o">,</span> <span class="mf">0.85</span><span class="o">,</span> <span class="mf">0.92</span><span class="o">,</span> <span class="mi">1</span><span class="o">)</span> 
    <span class="n">_Direction</span> <span class="o">(</span><span class="s">&quot;Direction&quot;</span><span class="o">,</span> <span class="n">Vector</span><span class="o">)</span> <span class="o">=</span> <span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="mf">4.5</span><span class="o">,</span> <span class="mf">1.2</span><span class="o">,</span> <span class="mf">3.3</span><span class="o">)</span> 
    <span class="n">_RefractionTex</span> <span class="o">(</span><span class="s">&quot;Environment Refraction&quot;</span><span class="o">,</span> <span class="mf">2D</span><span class="o">)</span> <span class="o">=</span> <span class="s">&quot;white&quot;</span> <span class="o">{}</span>
    <span class="n">_RefractionMap</span> <span class="o">(</span><span class="s">&quot;Refraction Map&quot;</span><span class="o">,</span> <span class="n">Cube</span><span class="o">)</span> <span class="o">=</span> <span class="err">“</span><span class="n">black</span><span class="err">”</span> <span class="o">{}</span>
<span class="o">}</span></code></pre></figure>

<p>这个全属性例子包含了上面所有属性，在编辑器上展示的属性如下。</p>

<p><img src="/assets/book/7/shader9.png" alt="shader全属性"></p>

<p>注意，这里为什么属性前都要加一个”_”，这是个习惯性写法，没有任何强制性，只是大部分程序员在书写Shader属性变量的习惯，逐渐形成了一个传统。</p>

<p>如果硬要套个说法，那就只能是”_”代表内部变量。就像我们书写代码变量时会有一些小习惯和规则一样，没有其他影响。</p>

<h6>Property属性默认值</h6>

<p>每个Property属性都有一个默认值，默认值是必须填写的，否则Shader编译器不会通过编译。这里我们说明一下所有属性的默认值。</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>    1，Number类型。Range，默认值必须在最大和最小值之间，比如Range(0,1)时值为默认值必须为0到1之间。Float，默认值可以为任意浮点数。Int，默认值可以为任意整数，且仅仅只能是整数，不能是浮点数。

    2，Color颜色类型。Color，默认值为4个浮点数，按照RGBA的顺序，第一个代表红色，第二个代表绿色，第三个代表蓝色，第四个代表透明度alpha。

    3，Vector方向坐标类型。Vector，默认值为4个浮点数，按照xyzw的顺序，第一个代表X坐标，第二个代表Y坐标，第三个代表Z坐标，第四个代表角度，深度等其他意义。Vector四个坐标完全可以代表任意值，比如前两个代表2D的X和Y，后面两个代表宽度和长度，再比如，前两个代表uv，后两个代表宽度和长度，或者比如前三个表示x，y，z，最后一个代表透明度alpha。

    4，2D Texture贴图类型。2D Texture，默认值有一个默认的颜色，”white”代表(RGBA:1,1,1,1)白色，”black”代表(RGBA:0,0,0,0)黑色，”gray”代表(RGBA:0.5,0.5,0.5,0.5)灰色，”bump”代表(RGBA:0.5,0.5,1,0.5)灰黄色，”red”代表(RGBA:1,0,0,0)红色。

    5，Cube，3D Texture，2DArray非2D贴图类型。默认值为空，当材质球编辑器中没有设置他们的实例时，他们使用灰色(RGBA:0.5,0.5,0.5,0.5)做默认值。
</code></pre></div>
<p>每个属性值的值在Material材质上都会被序列化后写入Material材质球的Meta文件。</p>

<p>Shader里实际上可以有很多参数，比如矩阵，数组等，但这些都需要在Shader实时运行中设置和获取的变量，不能成为Property的一部分，因为他们不是Property属性的一部分，也不会被记录存储在Mate文件里。</p>

<p>在Mate文件里的属性，我们不但可以通过Unity编辑器视窗中来赋值和变更，也可以通过脚本程序来赋值和改变，例如Material.SetFloat可以用来设置Shader中Float类型的属性，Material.SetColor用来设置Color类型的属性，Material. SetTexture可以用来设置 Texture类型的属性。</p>

<p>没有在Property中的属性类型或变量也同样可以使用Material.SetXXX(“PropertyName”,value)来设置，比如我们可以通过Material. SetMatrix设置矩阵类型在Shader中的变量，虽然矩阵没有在属性块中，我们照样可以设置，只要它在Shader程序变量中声明过就可以。</p>

<p>下面代码就是一个很好的例子：</p>

<figure class="highlight"><pre><code class="language-c#" data-lang="c#"><span></span><span class="k">public</span> <span class="k">class</span> <span class="nc">ExampleClass</span> <span class="p">:</span> <span class="n">MonoBehaviour</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="kt">float</span> <span class="n">rotateSpeed</span> <span class="p">=</span> <span class="m">30f</span><span class="p">;</span>
    <span class="k">public</span> <span class="k">void</span> <span class="nf">Update</span> <span class="p">()</span>
    <span class="p">{</span>
        <span class="n">Quaternion</span> <span class="n">rot</span> <span class="p">=</span> <span class="n">Quaternion</span><span class="p">.</span><span class="n">Euler</span> <span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="n">Time</span><span class="p">.</span><span class="n">time</span> <span class="p">*</span> <span class="n">rotateSpeed</span><span class="p">);</span>
        <span class="n">Matrix4x4</span> <span class="n">m</span> <span class="p">=</span> <span class="n">Matrix4x4</span><span class="p">.</span><span class="n">TRS</span> <span class="p">(</span><span class="n">Vector3</span><span class="p">.</span><span class="n">zero</span><span class="p">,</span> <span class="n">rot</span><span class="p">,</span> <span class="n">Vector3</span><span class="p">.</span><span class="n">one</span><span class="p">);</span>
        <span class="n">GetComponent</span><span class="p">&lt;</span><span class="n">Renderer</span><span class="p">&gt;().</span><span class="n">material</span><span class="p">.</span><span class="n">SetMatrix</span> <span class="p">(</span><span class="s">&quot;_TextureRotation&quot;</span><span class="p">,</span> <span class="n">m</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">///// Shader部分</span>
<span class="n">Shader</span> <span class="s">&quot;RotatingTexture&quot;</span>
<span class="p">{</span>
    <span class="n">Properties</span>
    <span class="p">{</span>
        <span class="n">_MainTex</span> <span class="p">(</span><span class="s">&quot;Base (RGB)&quot;</span><span class="p">,</span> <span class="m">2D</span><span class="p">)</span> <span class="p">=</span> <span class="s">&quot;white&quot;</span> <span class="p">{}</span>
    <span class="p">}</span>
    <span class="n">SubShader</span>
    <span class="p">{</span>
        <span class="n">Pass</span>
        <span class="p">{</span>
            <span class="n">CGPROGRAM</span>
            <span class="cp">#pragma vertex vert</span>
            <span class="cp">#pragma fragment frag</span>

            <span class="k">struct</span> <span class="nc">v2f</span>
            <span class="p">{</span>
                <span class="n">float2</span> <span class="n">uv</span> <span class="p">:</span> <span class="n">TEXCOORD0</span><span class="p">;</span>
                <span class="n">float4</span> <span class="n">pos</span> <span class="p">:</span> <span class="n">SV_POSITION</span><span class="p">;</span>
            <span class="p">};</span>

            <span class="n">float4x4</span> <span class="n">_TextureRotation</span><span class="p">;</span>

            <span class="n">v2f</span> <span class="nf">vert</span> <span class="p">(</span><span class="n">float4</span> <span class="n">pos</span> <span class="p">:</span> <span class="n">POSITION</span><span class="p">,</span> <span class="n">float2</span> <span class="n">uv</span> <span class="p">:</span> <span class="n">TEXCOORD0</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">v2f</span> <span class="n">o</span><span class="p">;</span>
                <span class="n">o</span><span class="p">.</span><span class="n">pos</span> <span class="p">=</span> <span class="n">UnityObjectToClipPos</span><span class="p">(</span><span class="n">pos</span><span class="p">);</span>
                <span class="n">o</span><span class="p">.</span><span class="n">uv</span> <span class="p">=</span> <span class="n">mul</span><span class="p">(</span><span class="n">_TextureRotation</span><span class="p">,</span> <span class="n">float4</span><span class="p">(</span><span class="n">uv</span><span class="p">,</span><span class="m">0</span><span class="p">,</span><span class="m">1</span><span class="p">)).</span><span class="n">xy</span><span class="p">;</span>
                <span class="k">return</span> <span class="n">o</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="n">sampler2D</span> <span class="n">_MainTex</span><span class="p">;</span>
            <span class="n">fixed4</span> <span class="nf">frag</span> <span class="p">(</span><span class="n">v2f</span> <span class="n">i</span><span class="p">)</span> <span class="p">:</span> <span class="n">SV_Target</span>
            <span class="p">{</span>
                <span class="k">return</span> <span class="nf">tex2D</span><span class="p">(</span><span class="n">_MainTex</span><span class="p">,</span> <span class="n">i</span><span class="p">.</span><span class="n">uv</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="n">ENDCG</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>上述代码中，_TextureRotation 并不是Property属性块中的变量，SetMatrix也同样可以通过材质球实例在程序运行时进行设置。</p>

<p>这就告诉我们，程序运行时设置Shader中的变量，并不是一定要在Property属性块中声明的。</p>

<p>其他比如获取Material中的变量可以通过Material.GetXXX(“PropertyName”)来获得，比如Material. GetTexture，Material.GetColor，Material.GetFloat等等。关于Material的很多功能可以通过查看Material的API来了解，这里不再详细介绍。</p>

<h6>属性的Attributes特性和Drawers绘制工具</h6>

<p>在书写属性时可以加入一些特性来让属性的用途更加明显，属性的特性有如下：</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>    [HideInInspector] 在视窗中隐藏。

    [NoScaleOffse] 不显示贴图的tiling/offset属性。

    [Normal] 表明这张贴图是张法线贴图。

    [HDR] 表明这贴图是张高动态范围贴图。

    [Gamma] 表明这个Float或者Vector属性是个RGB类型的颜色，可能会需要转换成以符合的格式使用。

    [PerRendererData] 表明这张贴图每帧都会被MaterialPropertyBlock重新设置。
</code></pre></div>
<p>书写方式就是在属性前加入这些特性，如下：</p>

<figure class="highlight"><pre><code class="language-c#" data-lang="c#"><span></span><span class="n">Properties</span>
<span class="p">{</span>
<span class="na">    [HideInInspector]</span> <span class="n">_Scale</span> <span class="p">(</span><span class="s">&quot;Scale&quot;</span><span class="p">,</span> <span class="n">Range</span> <span class="p">(</span><span class="m">0.02</span><span class="p">,</span><span class="m">0.15</span><span class="p">))</span> <span class="p">=</span> <span class="m">0.07</span>
    <span class="n">_PahLength</span><span class="p">(</span><span class="s">&quot;Path Length&quot;</span><span class="p">,</span> <span class="n">Float</span><span class="p">)</span> <span class="p">=</span> <span class="m">1.5</span>
    <span class="n">_OrderNumber</span><span class="p">(</span><span class="s">&quot;Order Number&quot;</span><span class="p">,</span> <span class="n">Int</span><span class="p">)</span> <span class="p">=</span> <span class="m">53</span>
<span class="na">    [Gamma]</span>  <span class="n">_RefrColor</span> <span class="p">(</span><span class="s">&quot;Refraction color&quot;</span><span class="p">,</span> <span class="n">Color</span><span class="p">)</span> <span class="p">=</span> <span class="p">(</span><span class="m">0.34</span><span class="p">,</span> <span class="m">0.85</span><span class="p">,</span> <span class="m">0.92</span><span class="p">,</span> <span class="m">1</span><span class="p">)</span> 
    <span class="n">_Direction</span> <span class="p">(</span><span class="s">&quot;Direction&quot;</span><span class="p">,</span> <span class="n">Vector</span><span class="p">)</span> <span class="p">=</span> <span class="p">(</span><span class="m">2</span><span class="p">,</span> <span class="m">4.5</span><span class="p">,</span> <span class="m">1.2</span><span class="p">,</span> <span class="m">3.3</span><span class="p">)</span> 
<span class="na">    [NoScaleOffse]</span>  <span class="n">_RefractionTex</span> <span class="p">(</span><span class="s">&quot;Environment Refraction&quot;</span><span class="p">,</span> <span class="m">2D</span><span class="p">)</span> <span class="p">=</span> <span class="s">&quot;white&quot;</span> <span class="p">{}</span>
    <span class="n">_RefractionMap</span> <span class="p">(</span><span class="s">&quot;Refraction Map&quot;</span><span class="p">,</span> <span class="n">Cube</span><span class="p">)</span> <span class="p">=</span> <span class="err">“</span><span class="n">black</span><span class="err">”</span> <span class="p">{}</span>
<span class="p">}</span></code></pre></figure>

<p>Drawers绘制特性列举：</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>    Drawer和Attribute的区别就是Drawer主要关注点在工具的绘制上，而不是对属性的限制。

    [Toggle] 表明此数字为开关类型，只有0，或1的选择。

    [Enum] 表明此变量只能从几个选项中选择。

    [KeywordEnum] 表明只能在选项中选择关键字，这个特性通常用在开关Shader的部分功能。

    [PowerSlider] 显示一个非线性的属性选择范围。

    [IntRange] 显示一个数字范围，这个数字范围内必须是整数。

    [Space] 在视窗中的属性前创建一个垂直的空隙。

    [Header] 在视窗的属性前展示一个文字说明。
</code></pre></div>
<p>例如下面的属性绘制特性</p>

<figure class="highlight"><pre><code class="language-c#" data-lang="c#"><span></span><span class="n">Properties</span>
<span class="p">{</span>
<span class="na">        [PowerSlider]</span> <span class="n">_Scale</span> <span class="p">(</span><span class="s">&quot;Scale&quot;</span><span class="p">,</span> <span class="n">Range</span> <span class="p">(</span><span class="m">0.02</span><span class="p">,</span><span class="m">0.15</span><span class="p">))</span> <span class="p">=</span> <span class="m">0.07</span>
<span class="na">        [Space(100)]</span> <span class="n">_PahLength</span><span class="p">(</span><span class="s">&quot;Path Length&quot;</span><span class="p">,</span> <span class="n">Float</span><span class="p">)</span> <span class="p">=</span> <span class="m">1.5</span>
<span class="na">        [Toggle]</span> <span class="n">_OrderNumber</span><span class="p">(</span><span class="s">&quot;Order Number&quot;</span><span class="p">,</span> <span class="n">Int</span><span class="p">)</span> <span class="p">=</span> <span class="m">53</span>
<span class="na">        [Enum(small,1,big,2,huge,10)]</span> <span class="n">_Size</span> <span class="p">(</span><span class="s">&quot;size&quot;</span><span class="p">,</span> <span class="n">Float</span><span class="p">)</span> <span class="p">=</span> <span class="m">1</span>
        <span class="n">_Direction</span> <span class="p">(</span><span class="s">&quot;Direction&quot;</span><span class="p">,</span> <span class="n">Vector</span><span class="p">)</span> <span class="p">=</span> <span class="p">(</span><span class="m">2</span><span class="p">,</span> <span class="m">4.5</span><span class="p">,</span> <span class="m">1.2</span><span class="p">,</span> <span class="m">3.3</span><span class="p">)</span> 
<span class="na">        [Header(ok head)]</span> <span class="n">_RefractionTex</span> <span class="p">(</span><span class="s">&quot;Environment Refraction&quot;</span><span class="p">,</span> <span class="m">2D</span><span class="p">)</span> <span class="p">=</span> <span class="s">&quot;white&quot;</span> <span class="p">{}</span>
        <span class="n">_RefractionMap</span> <span class="p">(</span><span class="s">&quot;Refraction Map&quot;</span><span class="p">,</span> <span class="n">Cube</span><span class="p">)</span> <span class="p">=</span> <span class="s">&quot;black&quot;</span> <span class="p">{}</span>
<span class="p">}</span></code></pre></figure>

<p>绘制结果截图</p>

<p><img src="/assets/book/7/shader10.png" alt="Drawer绘制"> </p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2018/08/07/Unity3D%E9%AB%98%E7%BA%A7%E7%BC%96%E7%A8%8B%E4%B9%8B%E8%BF%9B%E9%98%B6%E4%B8%BB%E7%A8%8B-Shader1.html">
        《Unity3D高级编程之进阶主程》第七章，Shader(一) - 常用的Shader
      </a>
    </h1>

    <span class="post-date">07 Aug 2018</span>

    <h3>常用的Shader</h3>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2018/08/06/Unity3D%E9%AB%98%E7%BA%A7%E7%BC%96%E7%A8%8B%E4%B9%8B%E8%BF%9B%E9%98%B6%E4%B8%BB%E7%A8%8B-%E7%BD%91%E7%BB%9C%E5%B1%821.html">
        《Unity3D高级编程之进阶主程》第六章，网络层(一) - TCP还是UDP
      </a>
    </h1>

    <span class="post-date">06 Aug 2018</span>

    <h3>有哪些网络协议可以用</h3>

<p>TCP（Transmission Control Protocol，传输控制协议）是面向连接的协议，也就是说，在收发数据前，必须和对方建立可靠的连接。</p>

<p>一个TCP连接必须要经过三次“对话”才能建立起来，其中的过程非常复杂，只简单的描述下这三次对话的简单过程：主机A向主机B发出连接请求数据包：“我想给你发数据，可以吗？”，这是第一次对话；主机B向主机A发送同意连接并要求同步的数据包（同步就是两台主机一个在发送，一个在接收，协调工作）：“可以，你什么时候发？”，这是第二次对话；主机A再发出一个数据包确认主机B的要求同步：“我现在就发，你接着吧！”，这是第三次对话。三次“对话”的目的是使数据包的发送和接收同步，经过三次“对话”之后，主机A才向主机B正式发送数据。</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2018/08/06/Unity3D%E9%AB%98%E7%BA%A7%E7%BC%96%E7%A8%8B%E4%B9%8B%E8%BF%9B%E9%98%B6%E4%B8%BB%E7%A8%8B-3D%E6%A8%A1%E5%9E%8B%E4%B8%8E%E5%8A%A8%E7%94%BB3.html">
        《Unity3D高级编程之进阶主程》第五章，3D模型与动画(三) - 状态机
      </a>
    </h1>

    <span class="post-date">06 Aug 2018</span>

    <h2>如何用状态机模拟人物行为动作。</h2>

<p>什么是状态机？</p>

<p>状态机有两种，一种是有限状态机，一种是无限状态机。有限状态机运用的地方比较多，而无限状态机我还没看见过有在游戏项目中运用的。我们这里讲的状态机都是有限状态机。</p>

<p>有限状态机简单描述下，实例本身有很多种状态，实例从一种状态切换到另一种状态的动作就是状态机转换，而转换是有条件的，这个条件就是状态机之间的连线。</p>

<p>打个比方，人有三个状态健康，感冒，康复中。触发的条件有淋雨（t1），吃药（t2），打针（t3），休息（t4）。状态机的连接图可以是这样，健康-（t4休息）-&gt;健康；健康-（t1淋雨）-&gt;感冒；感冒-（t3打针）-&gt;健康；感冒-（t2吃药）-&gt;康复中；康复中-（t4休息）-&gt;健康，等等。状态在不同的条件下跳转到自己或不同状态中去。</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2018/08/03/%E8%A2%AB%E5%B0%81%E7%BA%AA%E5%BF%B5%E5%B8%96.html">
        被封纪念帖
      </a>
    </h1>

    <span class="post-date">03 Aug 2018</span>

    <p>www.luzexi.com 博客 被关小黑屋了，原因是自己架了梯子，还写文章教别人怎么架梯子。被冠以双重罪，直接封服务器了，不仅仅是域名，服务器也不给用了。</p>

<p>这是不给程序员活路么，不学习外来技术怎么振兴中华。</p>

<p>但是我想通了，生活在中国就要按照中国的规矩办事，政治觉悟要有。</p>

<p>被封让我彻底放弃了阿里云，也放弃了国外的服务器，转而用国内，也同时放弃了自建某些服务器，感觉也轻松了很多，并且又多了一个域名，luzexi.cn 因为原来的域名不知道什么时候恢复，暂时用这个吧。</p>

<p>我想明白了在中国还是需要按中国的套路走，如果你移民在国外也一样，要拼劲全力融入当地的风俗民习，都不容易。</p>

<p>所以那些在国外的说国内不好的，或者在国内说国外不好的，都是井底之蛙，过于偏见纠结问题的表面。</p>

<p>做好自己，在规矩下办事，在规则下取胜才是关键，不要去秀下限，而是要努力去突破上限。</p>

<p>放个连接吧，总不至于白写。</p>

<p><a href="https://github.com/luzexi/blog/blob/master/luzexi.com/hyde-master/_posts/2018-08-01-%E8%A2%AB%E5%B0%81%E7%9A%84%E5%B8%96%E5%AD%90.md">被封的说明书</a></p>

  </div>
  
</div>

<div class="pagination">
  
    <a class="pagination-item older" href="/page2">下一页</a>
  
  
    <span class="pagination-item newer">上一页</span>
  
</div>
    </div>

    
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?f3d58556a7396e715b3602ef6754cd91";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>


    <script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>

  </body>
  
</html>
