<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      技术人生 &middot; luzexi.com
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/hyde.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-144-precomposed.png">
                                 <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body>

    <div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <h1>
        <a href="/">
          技术人生
        </a>
      </h1>
      <p class="lead">我将在这里写下我毕生所学---分享是我的一直以来坚持的事,不仅仅是为别人更是为了自己</p>
    </div>

    <nav class="sidebar-nav">
      <a class="sidebar-nav-item" href="/">Home</a>

      

      
      
        
          
        
      
        
          
            <a class="sidebar-nav-item" href="/about/">About</a>
          
        
      
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      

      <!-- <a class="sidebar-nav-item" href="https://github.com/luzexi/archive/v2.1.0.zip">Download</a> -->
      <a class="sidebar-nav-item" href="https://github.com/luzexi">GitHub project</a>
      <!-- <span class="sidebar-nav-item">Currently v2.1.0</span> -->
    </nav>

    <p>&copy; 2015. All rights reserved.</p>
  </div>
</div>


    <div class="content container">
      <div class="posts">
  
  <div class="post">
    <h1 class="post-title">
      <a href="/unity3d/%E6%B8%B8%E6%88%8F%E6%9E%B6%E6%9E%84/2014/06/06/Unity3D%E4%B9%8B%E5%A6%82%E4%BD%95%E5%B0%86%E5%8C%85%E5%A4%A7%E5%B0%8F%E5%87%8F%E5%B0%91%E5%88%B0%E6%9E%81%E8%87%B4/">
        Unity3D之如何将包大小减少到极致
      </a>
    </h1>

    <span class="post-date">06 Jun 2014</span>

    <p>Unity3D之如何将包大小减少到极致,图片是游戏app里最最占空间的资源，所以请各位还没有理解u3d对图片文件存储方式理解的请看<a href="/unity3d/2014/05/21/Unity3D-Texture%E5%9B%BE%E7%89%87%E7%A9%BA%E9%97%B4%E5%92%8C%E5%86%85%E5%AD%98%E5%8D%A0%E7%94%A8%E5%88%86%E6%9E%90/">《unity3d-texture图片空间和内存占用分析》</a>。因为u3d对资源的压缩并不阐述的十分详细，所以很多项目在遇到包大小瓶颈时非常头疼。我也不是神仙，也同样痛苦过，但经历几个项目的折腾，最终能梳理出一套能将u3d包大小减少到合理范围的方法。</p>

<p>首先来展示下，官方如何说的:（<a href="http://docs.unity3d.com/Manual/ReducingFilesize.html">http://docs.unity3d.com/Manual/ReducingFilesize.html</a> 官方手册）</p>

<p>1.替换jpg，使用psd，减少重复资源</p>

<p>2.剔除不必要的资源</p>

<p>3.打包时查看log纪录，由此判断需要减少的文件类型</p>

<p>4.优化，压缩图片，减少图片大小</p>

<p>5.优化，压缩网格和动画，减少文件大小</p>

<p>6.剔除system.dll和system.xml.dll ,尽量不要依赖他们，或用其他组件来代替。</p>

<p>这些官方解释对我们帮助甚少。我把包分成三段：1.首包(里面包含了最最必要的资源)。2.首次进入包加载(加载游戏运行必要的资源)。3.游戏运行中资源加载(按每个游戏不同各自定义，以场景和单位个体为主要，在画面进入时加载资源，加载结束后再运行并显示)。</p>

<p>关于u3d的AssetBundle资源加载与打包封装，请查看<a href="/unity3d/%E6%B8%B8%E6%88%8F%E9%80%9A%E7%94%A8%E6%A8%A1%E5%9D%97/2014/04/16/Unity3D%E4%B9%8BAssetBundle%E8%B5%84%E6%BA%90%E5%8A%A0%E8%BD%BD%E5%B0%81%E8%A3%85/">《unity3d之assetbundle资源加载封装》</a>这篇文章。</p>

<p>下面说说关于动态资源加载和资源导入内存的所有方式，这是优化资源的必要条件，因为只有你知道了所有的加载和导入途径你才能对项目资源优化进行全面的分析。知道了有哪几条路你才能选择一条最好的。如下：</p>

<p>利用动态资源加载有几种方式：</p>

<p>1.将资源放入assetstream文件夹随打包一起打入文件。</p>

<p>2.将部分资源放在服务器，游戏前或游戏中进行加载，并保存到本地。</p>

<p>3.将资源压缩成多个zip文件放在服务器，客户端下载这些zip文件合成一个zip文件进行解压。</p>

<p>其实www.LoadFromCacheOrDownload加载机制也可以算一种，但好像u3d4.5.2开始已经摒弃这个接口，不再开放，因为它也开始意识到这个接口容易给人造成误解，而且不好用。
资源导入内存的方式有几种：</p>

<p>1.从Resources文件夹中导入。这是阻塞加载最常见的方式，接口Resources.Load();</p>

<p>2.从某地址加载资源www。这是异步加载最常见方式，接口new www(path);</p>

<p>3.直接从文件或者bytes[]生成AssetBundl，接口：AssetBundle.CreateFromFile阻塞方法, AssetBundle.CreateFromMemory异步方法，AssetBundle.CreateFromMemoryImmediate阻塞方法</p>

<p>4.使用File类加载文件，File.ReadAllBytes，File.ReadAllText。</p>

<p>有了资源加载和内存导入后，还需要配备资源验证方式，这样整个项目动态加载体制才完善。资源版本更新方式可以使用json格式并以文件形式查看。验证方式的理解，还需要大家使用在项目里才能体会到真正的用途，才能将原理牢记于心。</p>

<p>验证资源版本有几种：</p>

<p>1.资源整体验证。步骤：1.客户端向服务器发送资源版本。2.服务器匹配最近版本号，若版本号不同，比较两个版本号之间的内容差异，发送差异资源地址。3.客户端删除差异内容中需要删除的文件资源，加载需要下载的文件资源并保存文件。最后保存版本号。</p>

<p>2.单个资源文件的时间戳验证。步骤：1.客户端向服务器发送资源版本号。2.服务器匹配最新版本号，如果不同就重新发送一份资源版本列表，里面包含了资源文件的时间戳。3.保存版本列表。4.在客户端需要加载该资源时比较时间戳是否一致，如果不一样或这不存在就加载资源文件并保存固定时间戳。</p>

<p>3.单个资源文件md5验证。步骤：1.客户端向服务器发送资源版本号。2.服务器匹配最新版本号，如果不同重新发送一分资源版本列表，里面包含了资源文件的md5码。3.客户端比较新旧资源版本列表中的，删除需要删除的和更新的资源。4.在客户端需要加载该资源时查看文件是否存在，如果存在就说明资源是最新的。如果不存在则需要实时下载。</p>

<p>转发请注明出处:http://www.luzexi.com</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/unity3d/2014/05/21/Unity3D-Texture%E5%9B%BE%E7%89%87%E7%A9%BA%E9%97%B4%E5%92%8C%E5%86%85%E5%AD%98%E5%8D%A0%E7%94%A8%E5%88%86%E6%9E%90/">
        Unity3D--Texture图片空间和内存占用分析
      </a>
    </h1>

    <span class="post-date">21 May 2014</span>

    <p>Texture图片空间和内存占用分析。由于U3D并没有很好的诠释对于图片的处理方式，所以很多人一直对于图集的大小和内存的占用情况都不了解。在此对于U3D的图片问题做一个实际数据的分析。此前的项目都会存在这样或者那样的打包后包大小与内存占用情况的问题，所以这次所以彻彻底底得分析下U3D对于Texture的处理方式。程序里的内存优化请参考<a href="/unity3d/%E6%B8%B8%E6%88%8F%E6%9E%B6%E6%9E%84/2014/02/22/Unity3d%E4%BC%98%E5%8C%96%E4%B9%8B%E8%B7%AF/">《unity3d优化之路》</a>。减少U3D包大小请参考<a href="/unity3d/%E6%B8%B8%E6%88%8F%E6%9E%B6%E6%9E%84/2014/06/06/Unity3D%E4%B9%8B%E5%A6%82%E4%BD%95%E5%B0%86%E5%8C%85%E5%A4%A7%E5%B0%8F%E5%87%8F%E5%B0%91%E5%88%B0%E6%9E%81%E8%87%B4/">《unity3d之如何将包大小减少到极致》</a>。</p>

<p>我打包多种类型的项目，空项目和10张放在Resources文件夹中的图为比较案例。以下是比较数据。</p>

<p>IPHONE：</p>

<p>1.空项目----空间占用量42.3MB----IPA大小10MB</p>

<p>2.10张1200*520无压缩Texure 单张图占用量2.8MB----空间占用量70.2MB----IPA大小22.9MB</p>

<p>3.10张1200<em>520压缩成1024</em>1024PVRTC4 单张图占用量0.5MB----空间占用量47.3MB----IPA大小13.2MB</p>

<ol>
<li>10张1024*1024无压缩Texture 单张图占用量4MB----空间占用量82.3MB----IPA大小14.6MB</li>
</ol>

<p>5.10张1024*1024压缩为PVRTC4格式 单张图占用量0.5MB----空间占用量47.3MB----IPA大小11.6MB</p>

<p>宗上数据总结：</p>

<p>一、2的N次方大小的图片会得到引擎更大的支持，包括压缩比率，内存消耗，打包压缩大小，而且支持的力度非常大。</p>

<p>二、减小图片的占用大小和内存方式有:图片大小变化(Maxsize),色彩位数变化(16位，32位)，压缩(PVRC)。</p>

<p>三、U3D对于图片的格式是自己生成的，而并不是你给他什么格式，他就用什么格式，一张1024<em>1024图在无压缩格式下，它会被U3D以无压缩文件形式存放，也就是说U3D里的Texture Preview里显示的占用大小</em>*MB不只是内存占用大小，还是空间占用大小。如下图所示：
<img class="alignnone size-full wp-image-310" src="/assets/uploads/2014/05/QQ截图20140521102030.png" alt="QQ截图20140521102030" width="626" height="726" /></p>

<p>U3D的内部机制为自动生成图片类型来替换我们给的图片，在图片的压缩方式上需要进行谨慎的选择。</p>

<p>压缩格式在U3D的<a href="http://docs.unity3d.com/Documentation/Components/class-Texture2D.html">Component Reference</a>里有介绍我就不再详细介绍，只介绍几个重点的:</p>

<p>RGBA32格式为无压缩最保真格式，但也是最浪费内存和空间的格式。Automatic Turecolor和它一个意思。</p>

<p>RGBA16格式为无压缩16位格式，比32位节省一半的空间和内存。Automatic 16bits和它一个意思。</p>

<p>RGBA Compressed PVRTC 4bits格式为PVRTC图片格式，它相当于把图片更改了压缩方式新生成了一个图片来替换原来的我们给的图片格式(比如我们给的是PNG格式)。</p>

<p>注意：U3D所有图片的压缩格式都会以另一种方式来存储，不会以你给的方式来存储，只有你指定了某种格式，它才会转成你要的格式。而且压缩格式在Android里并不一定有效，因为Android的机型多，GPU的渲染方式也不一样，有的是Nvidia，有的是PowerVR，最最好的在安卓机子上启用RGBA16方式，因为这个是适应所有机型的，并且比32位占用量少一半，但也需要因项目而异，只是推荐使用的格式，可以多用。</p>

<p>转载请注明出自：http://www.luzexi.com</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/%E6%B8%B8%E6%88%8F%E6%9C%8D%E5%8A%A1%E7%AB%AF/%E6%B8%B8%E6%88%8F%E6%9E%B6%E6%9E%84/2014/04/18/WEB%E6%B8%B8%E6%88%8F%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%9E%B6%E6%9E%84(HTTP)/">
        WEB游戏服务器架构(HTTP)
      </a>
    </h1>

    <span class="post-date">18 Apr 2014</span>

    <p>WEB游戏服务器架构(HTTP)。在如今游戏中，越来越多使用WEB架构方式来做游戏，《临兵斗者三国志》也是其中一个。我使用了PHP来做WEB服务器主逻辑语言，原因为他的开发速度快，并且容易招人容易上手。
接下来主要来介绍下WEB服务器游戏架构的方式。(本文以PHP+MYSQL+MEMCACHE+NGINX为例)</p>

<p>PHP可以选用任何你熟悉的框架，能站在别人肩膀上的就站上去吧，自己写时间过长。我们选用的是Yii框架，特点不多没有刻意去挑选。Memcache主要存储数据表的内存，因为PHP没有内存可控制，所以结合Memchache是最好的选择，也可以用Redis，功能上都一样，不过Redis有排序而已。用NGINX主要用来做WEB端的负载平衡，也可以在测试时做IP过滤，以及维护时的IP封锁。</p>

<p>WEB架构图：</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">----------------------------------------------------------
GAME_DB1(Mysql-master&amp;slave)---|
GAME_DB2(Mysql-master&amp;slave)   |  
GAME_DB3(Mysql-master&amp;slave)   |---------------|
GAME_DB4(Mysql-master&amp;slave)---|               |
                                               |
Memcache1(master&amp;slave)                        |
Memcache2(master&amp;slave)                        |
Memcache3(master&amp;slave)                        |
Memcache4(master&amp;slvae)                        |
/       \                                      |
GameServerPHP1                                 |
GameServerPHP2---------------------------------|
GameServerPHP3  
|     /  
Nginx  
------------------------------------------  
GB_DB(Mysql)  
|  
GM_ADMIN_PHP+(memcache)  
------------------------------------------
</code></pre></div>
<p>描述：</p>

<p>Ngix起负载均衡作用。</p>

<p>Memcache起数据缓冲作用，当PHP从Memcache中读取数据发现Memcache没有，就从MYSQL里读并且存到Memcahe，查看Memcache玩家数据是否大于某个数(主要是限制内存，不能让Memcache内存无限增加最后导致奔溃)，当PHP需要更新和插入时，PHP先插入或更新到MYSQL，然后再插入或更新到Memcache，使得两边数据能够同步，抑或只插入或更新到MYSQL，在查询时再进行Memcache加载也可以。
Mysql和Memcache设置为多台，主要是用于当数据过大时的对数据库做的数据散列处理，就是将某块功能数据单独放在某个数据库上，抑或将主键以某种方式分段拆分，例如按每100万主键拆分Mysql,0-100万为1台Mysql,101-200万为另一台Mysql以此类推。</p>

<p>关于PHP框架的改造，我们需要遵循框架的接口，这样我们才能对底层的框架进行改造并且不影响上层的逻辑。例如上面提到的当查询时，先对Memcache进行操作，查看是否有数据，如没有再对Mysql操作，这种写法的基本条件就是接口必须使用框架固有的，而不是直接写sql语句来执行，但凡只用使用sql语句的都需要被改成框架接口，并且尽量不使用合并操作和查询嵌套。</p>

<p>关于数据统计，由于WEB没有逻辑线程，所以我使用Linux的任务或Windows的计划代替，每天执行一次某PHP脚本，每周执行一次某PHP脚本，以达到统计数据的要求。
这个框架是一般游戏服务器的架构，在即时上线时，因为前期人数并不多，服务器的台数可以自由调整，随着人数上线的增多可以动态得进行扩充GameServerPhp服务器的数量，Memcache服务器的数量，最后实在抗不住，也可以增加DB的数量。</p>

<p>转载请注明出处：http://www.luzexi.com</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/unity3d/%E6%B8%B8%E6%88%8F%E9%80%9A%E7%94%A8%E6%A8%A1%E5%9D%97/2014/04/16/Unity3D%E4%B9%8BAssetBundle%E8%B5%84%E6%BA%90%E5%8A%A0%E8%BD%BD%E5%B0%81%E8%A3%85/">
        Unity3D之AssetBundle资源加载封装
      </a>
    </h1>

    <span class="post-date">16 Apr 2014</span>

    <p>Unity3D之AssetBundle资源加载封装。在《临兵斗者三国志》中我使用了U3D的AssetBundle资源动态加载机制，原因是某些画面资源太多，IO阻塞过慢会造成游戏奔溃。在开发过程中，遇到点问题:</p>

<p>1.当资源更改变化时，如何能快速得反应到开发中。</p>

<p>解决方案:</p>

<p>我使用宏定义UNITY_EDITOR来判断是否是开发编辑状态。当处于开发编辑状态时，自动读取指定目录下U3D本身资源，而不使用AssetBundle。这样就达到了当prefb变化时能快速反应到开发编辑中。而当不是处于编辑状态时，则正常使用异步加载读取AssetBundle。这个方式唯一的毛病就是，必须让所有U3D程序员都非常清除明白，如果写错，编辑模式下会没问题，发布后会出问题，所以需要检查。</p>

<p>2.当不同资源之间有重复的资源时如何将AssetBundle空间占有量最小化。</p>

<p>解决方案:</p>

<p>GUI资源之间有特别多的重复的问题，挑出几个重复得特别厉害的，比如ICON图集，公用图集。在打包期间把他们设为共享资源，并在加载时首先加载共享资源，这样既节省了AssetBundle空间占有量，也节省了内存。这个方式的毛病是当你将资源更改要打包某个资源时，需要将所有与共享有关的资源重新打包一遍。</p>

<p>3.如何应对自动释放资源问题。</p>

<p>解决方案:</p>

<p>在游戏中有指定资源释放和自动释放所有AssetBundle资源以销毁内存(这里不是指销毁U3D内存，而是AssetBundle内存，U3D内存管理分图片内存，AssetBundle内存，编译程序)。销毁指定资源就按正常来没有争议。销毁所有资源就要有点措施了，因为有些资源是不能被销毁的，因为它们是共享资源，需要全程跟着游戏走，所以当自动销毁所有资源时，将共享资源排除在外。并且在销毁后调用Resources.UnloadUnusedAssets();和GC.Collect();</p>

<p>4.打包AssetBundle方式。</p>

<p>解决方案:</p>

<p>打包AssetBundle方式有几种:1.单资源打包，也就是说一个.prefb或Texture打一个包。2.多个资源打包，将某些资源都打成一个AssetBundle，节省了几个资源包之间的共享资源也减小了多个AssetBundle引起的空间扩大问题。但并不是说所有项目都是多个资源打成一个AssetBundle是好的。《临兵斗者三国志》就是一大部分使用单一打包，而共享资源使用多个资源打成一个AssetBundle的方式。</p>

<p>最后奉上本人对AssetBundle封装的源码。<a href="https://github.com/luzexi/Unity3DGameResource">https://github.com/luzexi/Unity3DGameResource</a></p>

<p>你也可以去我的<a href="https://github.com/luzexi">github</a>上查看找我做的一些源码插件，如果喜欢的话可以star或者fllow。</p>

<p>转发请注明出自：http://www.luzexi.com</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/unity3d/%E6%B8%B8%E6%88%8F%E6%9E%B6%E6%9E%84/2014/02/22/Unity3d%E4%BC%98%E5%8C%96%E4%B9%8B%E8%B7%AF/">
        Unity3d优化之路
      </a>
    </h1>

    <span class="post-date">22 Feb 2014</span>

    <p>Unity3d优化之路.U3D的架构部分已经讲了很多了，这里我想讲讲对于U3D优化的亲身体验。</p>

<p>优化之路分三块：</p>

<p>一.渲染级别。</p>

<p>GUI部分：我使用的是NGUI，它对动态移动、旋转、缩放GUI支持的是比较差的，所以我尽量不要把过多的移动旋转缩放的部分写在GUI中，但很多情况下是避免不了的，比如：大量的伤害数字，物品掉落，图标的移动和旋转等，为了不让GUI去控制这些渲染物体，一小部分我使用3D面片代替，而大部分使用程序去生成面片渲染脱离了GUI的控制。另外在那些静态的GUI中，我使用了静态物体优化的属性，加上排除不必要的GUI设置，使得GUI部分效率足够高。</p>

<p>3D部分：特效是对画面效果最最有影响的部分，我尽量不使用粒子或者将粒子的数量减少到最小。尽量减少灯光的使用，而使用烘培后的图来代替。剔除那些不需要显示的模型。</p>

<p>2D部分：特效不放在GUI内，而是把特效放在非GUI的另一个摄像头内代替。所以，最终摄像头会有多各，总共叠层是这样的：top:gui<em>effect</em>camera , middle:gui<em>camera , bottom:3d</em>camera;</p>

<p>二.减少占用空间大小。</p>

<p>1.我使用的是动态资源的加载方式WWW方式。所以在导出资源时我使用BuildAssetBundleOptions.DisableWriteTypeTree 的打包方式，减少包的大小。</p>

<p>因为WWW缓存方式在下载后解压后还是会增大空间占用量，所以我使用StreamAssets这个在Unity3D里固定文件夹，把WWW资源放在那里，在游戏开始后进行缓冲读取，这样既减少了空间占用量，也可以进行异步的读取资源方式，唯一的缺点是但凡更改资源就需要玩家下载新的游戏包。对于两种方式的WWW资源加载，在具体项目当中可以共同使用，一部分使用网络加载，一部分使用本地StreamAssets加载。</p>

<p>2.对每张Texture，都设置对图片进行压缩。</p>

<p>3.让美术减少模型面片数，并在fbx模型设置中，设置对模型进行压缩</p>

<p>4.让美术减少动画帧数，并在动画设置中，设置对动画进行压缩</p>

<p>5.不使用System,System.Xml以及其他系统自带的DLL,他会多出几兆空间,而用开源的源码代替。</p>

<p>三.内存</p>

<p>1.最基本的就是对需要的资源进行加载，使用完毕后，释放。</p>

<p>2.GUI部分在GUIManager管理类中增加 对GUI进行定时检查的部分，对不展示的GUI资源进行释放。</p>

<p>3.因为有些时候一次性加载的资源过多，内存一下子会膨胀，IO过慢导致奔溃，所以我选择资源异步加载。使得加载这么多资源不那么可怕，并且平滑。</p>

<p>4.内存释放：这里有个重点，我重点测试了一下内存释放的忽视点。在我们利用ngui,或者2dtoolkit进行gui编程时，在释放其gui节点时通常会忘记将gui引用置为null，这就导致了内存泄漏。一些不再使用的贴图或者实例数据仍然继续存留在内存中。对于是否有需要将这些gui变量置为null的说法，我还做了一个实验。</p>

<p>首先将屏幕置空，没有任何多余内存，再将gui展示，接着隐藏gui销毁gameobject，先将所有引用变量置为null，然后再展示，再销毁，这次销毁，不将变量置为null。得出得内存结论就是，不将gui组件变量置为null的，贴图内存还会滞留。如下图：</p>

<p><img class="alignnone size-full wp-image-355" src="/assets/uploads/2014/02/48391BD3-BEAC-4E45-B6C4-17AA7B5B0428.png" alt="48391BD3-BEAC-4E45-B6C4-17AA7B5B0428" width="568" height="211" /></p>

<p>测试代码如下：</p>
<div class="highlight"><pre><code class="language-c#" data-lang="c#"><span class="k">using</span> <span class="nn">UnityEngine</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Collections</span><span class="p">;</span>

<span class="k">public</span> <span class="k">class</span> <span class="nc">testgui</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="n">tk2dSprite</span> <span class="n">tex</span><span class="p">;</span>
    <span class="k">private</span> <span class="n">GameObject</span> <span class="n">root</span><span class="p">;</span>

    <span class="k">private</span> <span class="n">tk2dSprite</span> <span class="n">tex1</span><span class="p">;</span>
    <span class="k">private</span> <span class="n">GameObject</span> <span class="n">root1</span><span class="p">;</span>

    <span class="k">private</span> <span class="n">tk2dSprite</span> <span class="n">tex2</span><span class="p">;</span>
    <span class="k">private</span> <span class="n">GameObject</span> <span class="n">root2</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">void</span> <span class="nf">show</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">root</span> <span class="p">=</span>  <span class="n">GameObject</span><span class="p">.</span><span class="n">Instantiate</span><span class="p">(</span> <span class="n">Resources</span><span class="p">.</span><span class="n">Load</span><span class="p">(&lt;</span><span class="n">span</span> <span class="n">class</span><span class="p">=</span><span class="s">&quot;string&quot;</span><span class="p">&gt;</span><span class="s">&quot;GameObject&quot;</span><span class="p">)</span> <span class="p">)</span> <span class="k">as</span> <span class="n">GameObject</span><span class="p">;</span>
        <span class="n">root</span><span class="p">.</span><span class="n">transform</span><span class="p">.</span><span class="n">parent</span> <span class="p">=</span> <span class="n">GameObject</span><span class="p">.</span><span class="n">Find</span><span class="p">(&lt;</span><span class="n">span</span> <span class="n">class</span><span class="p">=</span><span class="s">&quot;string&quot;</span><span class="p">&gt;</span><span class="s">&quot;ROOT/MIDDLE_CENTER&quot;</span><span class="p">).</span><span class="n">transform</span><span class="p">;</span>
        <span class="n">tex</span> <span class="p">=</span> <span class="n">root</span><span class="p">.</span><span class="n">GetComponent</span><span class="p">&lt;</span><span class="n">tk2dSprite</span><span class="p">&gt;();</span>

        <span class="n">root1</span> <span class="p">=</span>  <span class="n">GameObject</span><span class="p">.</span><span class="n">Instantiate</span><span class="p">(</span> <span class="n">Resources</span><span class="p">.</span><span class="n">Load</span><span class="p">(&lt;</span><span class="n">span</span> <span class="n">class</span><span class="p">=</span><span class="s">&quot;string&quot;</span><span class="p">&gt;</span><span class="s">&quot;GameObject1&quot;</span><span class="p">)</span> <span class="p">)</span> <span class="k">as</span> <span class="n">GameObject</span><span class="p">;</span>
        <span class="n">root1</span><span class="p">.</span><span class="n">transform</span><span class="p">.</span><span class="n">parent</span> <span class="p">=</span> <span class="n">GameObject</span><span class="p">.</span><span class="n">Find</span><span class="p">(&lt;</span><span class="n">span</span> <span class="n">class</span><span class="p">=</span><span class="s">&quot;string&quot;</span><span class="p">&gt;</span><span class="s">&quot;ROOT/MIDDLE_CENTER&quot;</span><span class="p">).</span><span class="n">transform</span><span class="p">;</span>
        <span class="n">tex1</span> <span class="p">=</span> <span class="n">root1</span><span class="p">.</span><span class="n">GetComponent</span><span class="p">&lt;</span><span class="n">tk2dSprite</span><span class="p">&gt;();</span>

        <span class="n">root2</span> <span class="p">=</span>  <span class="n">GameObject</span><span class="p">.</span><span class="n">Instantiate</span><span class="p">(</span> <span class="n">Resources</span><span class="p">.</span><span class="n">Load</span><span class="p">(&lt;</span><span class="n">span</span> <span class="n">class</span><span class="p">=</span><span class="s">&quot;string&quot;</span><span class="p">&gt;</span><span class="s">&quot;GameObject2&quot;</span><span class="p">)</span> <span class="p">)</span> <span class="k">as</span> <span class="n">GameObject</span><span class="p">;</span>
        <span class="n">root2</span><span class="p">.</span><span class="n">transform</span><span class="p">.</span><span class="n">parent</span> <span class="p">=</span> <span class="n">GameObject</span><span class="p">.</span><span class="n">Find</span><span class="p">(&lt;</span><span class="n">span</span> <span class="n">class</span><span class="p">=</span><span class="s">&quot;string&quot;</span><span class="p">&gt;</span><span class="s">&quot;ROOT/MIDDLE_CENTER&quot;</span><span class="p">).</span><span class="n">transform</span><span class="p">;</span>
        <span class="n">tex2</span> <span class="p">=</span> <span class="n">root2</span><span class="p">.</span><span class="n">GetComponent</span><span class="p">&lt;</span><span class="n">tk2dSprite</span><span class="p">&gt;();</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">void</span> <span class="nf">hiden1</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">GameObject</span><span class="p">.</span><span class="n">Destroy</span><span class="p">(</span><span class="n">root</span><span class="p">);</span>
        <span class="n">GameObject</span><span class="p">.</span><span class="n">Destroy</span><span class="p">(</span><span class="n">root1</span><span class="p">);</span>
        <span class="n">GameObject</span><span class="p">.</span><span class="n">Destroy</span><span class="p">(</span><span class="n">root2</span><span class="p">);</span>
        <span class="n">Resources</span><span class="p">.</span><span class="n">UnloadUnusedAssets</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">void</span> <span class="nf">hiden</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">GameObject</span><span class="p">.</span><span class="n">Destroy</span><span class="p">(</span><span class="n">root</span><span class="p">);</span>
        <span class="n">GameObject</span><span class="p">.</span><span class="n">Destroy</span><span class="p">(</span><span class="n">root1</span><span class="p">);</span>
        <span class="n">GameObject</span><span class="p">.</span><span class="n">Destroy</span><span class="p">(</span><span class="n">root2</span><span class="p">);</span>
        <span class="n">root</span> <span class="p">=</span> <span class="k">null</span><span class="p">;</span>
        <span class="n">root1</span> <span class="p">=</span> <span class="k">null</span><span class="p">;</span>
        <span class="n">root2</span> <span class="p">=</span> <span class="k">null</span><span class="p">;</span>
        <span class="n">tex</span> <span class="p">=</span> <span class="k">null</span><span class="p">;</span>
        <span class="n">tex1</span> <span class="p">=</span> <span class="k">null</span><span class="p">;</span>
        <span class="n">tex2</span> <span class="p">=</span> <span class="k">null</span><span class="p">;</span>
        <span class="n">Resources</span><span class="p">.</span><span class="n">UnloadUnusedAssets</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>请看红框内绿色曲线，第一次是置空的情况，内存立刻销毁，而第二次是不置空的情况，内存仍然驻留。结论很明显了，所以，在你编程时，将引用置空是件非常重要的事，这会直接影响到你的内存使用量。这也事c#垃圾回收机制引起的，当实例没有引用数量时内存才会被回收，并且彻底销毁。</p>

<p>笔者最后提醒优化无极限，其实都在细节中，能省一点CPU是一点，能省一点内存是一点。你不打败99.5%的其他人，你就没有机会功成名就。</p>

<p>转载请注明出处:http://www.luzexi.com</p>

  </div>
  
</div>

<div class="pagination">
  
    <a class="pagination-item older" href="/page5">Older</a>
  
  
    
      <a class="pagination-item newer" href="/page3">Newer</a>
    
  
</div>
    </div>

    
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?f3d58556a7396e715b3602ef6754cd91";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

  </body>
</html>
