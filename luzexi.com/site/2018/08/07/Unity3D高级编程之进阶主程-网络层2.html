<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
  <meta content="unity3d 高级编程 主程 network tcp udp" name="description">


  <title>
    
      《Unity3D高级编程之进阶主程》第六章，网络层(二) - 实现TCP
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/hyde.css?version=20180701">
  <!-- <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface"> -->

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-144-precomposed.png">
                                 <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body>

  	<div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <h2>
        <a href="/">
          技术人生
        </a>
      </h2>
      <p class="lead">技术，哲学，金融</p>
    </div>

    <nav class="sidebar-nav">
      <a class="sidebar-nav-item" href="/">Home</a>

      

      <a class="sidebar-nav-item" href="/书籍著作/index.html">书籍著作</a>
      <a class="sidebar-nav-item" href="/Unity3D/index.html">Unity3D</a>
      <a class="sidebar-nav-item" href="/游戏通用模块/index.html">游戏通用模块</a>
      <a class="sidebar-nav-item" href="/前端技术/index.html">前端技术</a>
      <a class="sidebar-nav-item" href="/后端技术/index.html">后端技术</a>
      <a class="sidebar-nav-item" href="/其他技术/index.html">其他技术</a>
      <a class="sidebar-nav-item" href="/金融投资/index.html">金融投资</a>
      <a class="sidebar-nav-item" href="/life/index.html">Life</a>

      
      
        
          
        
      
        
          
            <a class="sidebar-nav-item" href="/Util-page.html">常用页面工具</a>
          
        
      
        
          
            <a class="sidebar-nav-item" href="/about.html">我的简介</a>
          
        
      
        
      
        
          
            <a class="sidebar-nav-item" href="/engineer-shopping.html">程序员必需品</a>
          
        
      
        
      
        
          
            <a class="sidebar-nav-item" href="/friendlink.html">友情链接</a>
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
      
        
      
      
      <a class="sidebar-nav-item" href="https://github.com/luzexi">GitHub project</a>
      <a href="http://www.luzexi.com/assets/feed.xml">RSS feed</a>
      <!-- <span class="sidebar-nav-item">Currently v2.1.0</span> -->
    </nav>

    <p>&copy; 2020. All rights reserved. </p>
    <p><a href="http://www.beian.miit.gov.cn" target="_blank">浙ICP备13028172号-1</a></p>
  </div>
</div>


    <div class="content container">
      <div class="post">
  <h1 class="post-title">《Unity3D高级编程之进阶主程》第六章，网络层(二) - 实现TCP</h1>
  <span class="post-date">07 Aug 2018</span>

  <h3>实现TCP长连接。</h3>

<p>我们先从整体出发，列一下Unity3D实现TCP连接需要的实现哪些方面：</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>    1， 建立连接

    2， 断线检测

    3， 网络协议

    4， 发送和接收队列缓冲

    5， 发送数据合并

    6， 线程死锁策略
</code></pre></div>
<p>===</p>

<p>TCP本身已经有数据包可靠性确认，以及丢包重发机制，数据包的大小也没有限时，我们可以把这些功能称之为免费得到的功能。</p>

<p>所以在实现TCP的连接中不需要我们再做包体的校验，切割包体，以及重发数据包，省掉了很大一部分麻烦。</p>

<p>我们只需要做的就是建立连接，发送，以及接收。不过如果不对发送数据进行合并，就会有很多小的数据分批发送，导致发送效率低下。所以我们下文中会提到关于发送合并的问题。</p>

<p>简单介绍下TCP的API库</p>

<p>c#的.net库提供了TCP的Socket连接API，我们来看看c#的.net库中的这些API。</p>

<p>理论上你不会去用阻塞方式连接和接收，因为你不会让你的游戏卡住不动来等待连接，这有可能导致崩溃，所以连接，接收，断开，都是异步的线程操作。同步阻塞的操作可能会周边的工具中会用到，比如编辑器的工具，回放工具，GM的工具等，其他大部分时候都希望异步操作网络连接。</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>    BeginConnect，开始连接

    BeginReceive，开始接收信息

    BeginSend，开始发送数据

    BeginDisconnect，开始断开

    Disconnect(Boolean)，立刻断开连接
</code></pre></div>
<p>前四个都是异步的，调用后会开启一个线程来工作，最后一个是同步阻塞式的断开连接。最后一个阻塞式大都在游戏退出时调用，但APP没有退出事件，所以最后一个一般都在Unity3D Eitor下或者windows版本上调用，以保证在开发时强制退出后编辑器不会奔溃。</p>

<h6>线程锁</h6>

<p>网络部分基本上所有的操作都是线程级别的，Unity3D的渲染和逻辑是在主线程上运作的，这里就涉及到了主线程和子线程的资源线程锁的问题。</p>

<p>主线程与子线程一起工作时，如果都需要某个内存块，或者资源，就会同时去读取或者写入资源，这就是造成死锁的情况的根源。因此在调用有冲突的资源时，需要做锁的操作，用以防止线程们在读取或写入操作时对资源错误的争夺。</p>

<p>例如接收线程，接收到网络数据后将数据push到队列时，在push操作上做锁操作：</p>

<figure class="highlight"><pre><code class="language-c#" data-lang="c#"><span></span><span class="k">lock</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">mQueue</span><span class="p">.</span><span class="n">Push</span><span class="p">(</span><span class="n">data</span><span class="p">);</span>
<span class="p">}</span></code></pre></figure>

<p>或者主线程在读取网络数据时，在推出一个数据时，在Pop的操作上加一个锁的操作。</p>

<figure class="highlight"><pre><code class="language-c#" data-lang="c#"><span></span><span class="n">Lock</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">data</span> <span class="p">=</span> <span class="n">mQueue</span><span class="p">.</span><span class="n">Pop</span><span class="p">();</span>
<span class="p">}</span></code></pre></figure>

<p>每次对线程共享的资源进行操作时，都需要先进行锁确认的操作，以避免线程争夺资源而造成死锁。</p>

<h6>缓冲队列</h6>

<p>网络游戏中，数据会远远不断进行发送和接收，很多时候程序还没处理好当前的数据包，就已经有很多数据包从服务器传送到达了客户端。发送数据也是一样，会瞬间积累很多的需要发送的数据包，所以需要用队列来进行存储和缓冲。</p>

<p>负责接收的子线程把接收好的网络数据包放入接收缓冲队列，主线程通过Update轮训去检查接收队列里是否有数据，有的话就一个个取出来处理，没有的话继续轮训等待。</p>

<p>如下面伪代码表达了，主线程每帧检查一下是否有收到信息，检测到就立刻处理，没有的话下一帧继续轮训检测。如果没有信息接收来时，子线程上会阻塞等待直到有消息接收到才会调用接收消息接口，将数据包解析后推入接收队列。</p>

<figure class="highlight"><pre><code class="language-c#" data-lang="c#"><span></span><span class="c1">/////////////////////////////////////////////////////////</span>
<span class="c1">//接收线程等待接收数据并推入队列</span>
<span class="k">try</span>
<span class="p">{</span>
    <span class="n">socket</span><span class="p">.</span><span class="n">BeginReceive</span><span class="p">(</span> <span class="n">Receive_Callback</span> <span class="p">);</span>
<span class="p">}</span>
<span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">Log</span><span class="p">(</span><span class="n">LogerType</span><span class="p">.</span><span class="n">ERROR</span><span class="p">,</span> <span class="n">e</span><span class="p">.</span><span class="n">StackTrace</span><span class="p">);</span>
    <span class="n">DisConnect</span><span class="p">();</span>
<span class="p">}</span>

<span class="k">void</span> <span class="nf">Receive_CallBack</span><span class="p">(</span><span class="n">IAsyncResult</span>  <span class="n">_result</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">PushNetworkData</span><span class="p">(</span><span class="n">_result</span><span class="p">);</span> <span class="c1">//将数据推入队列</span>
    <span class="n">Receive</span><span class="p">();</span>    <span class="c1">//继续接收数据消息</span>
<span class="p">}</span>

<span class="c1">///////////////////////////////////////////////////////////////</span>
<span class="c1">//主线程处理数据队列里的数据</span>
<span class="k">void</span> <span class="nf">Update</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">While</span><span class="p">(</span> <span class="p">(</span><span class="n">data</span> <span class="p">=</span> <span class="n">PopNetworkData</span><span class="p">()</span> <span class="p">)!=</span> <span class="k">null</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="n">DealNetworkData</span><span class="p">(</span><span class="n">data</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>上面的伪代码中，首先有子线程的等待接收数据，接收到以后就立即将数据推入队列。另一面，主线程一直在轮询是否有已经接收到的网络数据，如果有就立即逐个处理全部数据。</p>

<h6>双队列结构</h6>

<p>这里介绍一下双队列数据结构，它能增加些许多线程中队列的读写效率。</p>

<p>双队列是一种高效的内存数据结构，在多线程编程中，能保证生产者线程的写入和消费者的读出尽量做到最低的影响，避免了共享队列的锁开销。</p>

<p>具体什么意思呢？其实很简单。</p>

<p>多个线程都需要对队列读写，接收数据的网络线程会将数据写入队列，而处理数据的主线程会读取队列并删除顶头的一个，两者都会读写队列，导致资源争夺。</p>

<p>加入了线程锁的机制后，仍然没能很好的解决两个线程同时操作一个队列的问题。例如假设处理数据的主线程需要花很久的时间去处理网络数据，这时接收数据的线程因为接收队列被主线程锁住不能继续自己的接收数据的操作，所以子线程被等待资源使用完毕后才能使用资源，如果这个数据很多很大很耗时，那么子线程就要等很少时间，大大降低了线程了效率。</p>

<p>用双队列的形式就能让线程处理队列时解放出来，让线程的效率大大增加，使得各线程能够各自处理调用各自的队列处理而不用因为资源锁而等待。</p>

<p>双队列是如何做到的呢？前面接收数据包部分都是一样的，接收数据线程接收到数据时直接推入接收数据的队列，不一样的地方在，当处理数据的线程轮询时，先将接收数据的队列拷贝到处理数据的队列中并清空接收数据的队列，主线再对拷贝后的数据队列进行处理，于是子线程能够顺利的继续接收数据而无需等待接收队列这个资源。这样就解放了两边的冲突时间了，各自只要处理自己的队列就可以了。</p>

<p>伪代码如下：</p>

<figure class="highlight"><pre><code class="language-c#" data-lang="c#"><span></span><span class="c1">/////////////////////////////////////////////</span>
<span class="c1">//子线程中，接收数据线程</span>
<span class="k">void</span> <span class="nf">Receive_CallBack</span><span class="p">(</span><span class="n">Data</span> <span class="n">_result</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">Pushdata</span><span class="p">(</span><span class="n">_result</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">/////////////////////////////////////////</span>
<span class="c1">//处理数据的主线程</span>
<span class="k">void</span> <span class="nf">SwitchQueue</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">lock</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">Swap</span><span class="p">(</span><span class="n">receiveQueue</span><span class="p">,</span> <span class="n">produceQueue</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">void</span> <span class="nf">Update</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">SwitchQueue</span><span class="p">();</span>
    <span class="k">while</span><span class="p">(</span> <span class="p">(</span><span class="n">data</span> <span class="p">=</span> <span class="n">PopQueue</span><span class="p">())</span> <span class="p">!=</span> <span class="k">null</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="n">Deal_with_network_data</span><span class="p">(</span><span class="n">data</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>伪代码中，首先是对子线程的接收部分描述，当接收到数据包时push到接收队列中，而当主线程需要处理数据时，先切换队列，防止对队列占用过多时间，切换完毕后，再对队列中的全部数据进行处理。</p>

<p>这样一来，锁的时间变短了，原本要在处理期间全程上锁导致其他线程无法使用，现在只在切换那一瞬间锁上资源，其他时间各线程都能顺畅得各自做自己的工作，大大提高了线程的效率。</p>

<script type="text/javascript">
    if (/(iPhone|iPad|iPod|iOS|Android)/i.test(navigator.userAgent))
    { //移动端
        /*mobile-20:5*/
        var cpro_id = "u3493987";
        document.write("\<script type=\"text\/javascript\" src=\"//cpro.baidustatic.com/cpro/ui/cm.js\"\>\<\/script\>");
    }
    else
    {
         /*700*200信息流*/
        var cpro_id = "u3469788";
        document.write("\<script type=\"text/javascript\" src=\"//cpro.baidustatic.com/cpro/ui/c.js\"\>\<\/script\>");
    }
</script>

<h6>发送数据</h6>

<p>我们前面说发送数据时也需要队列来做缓冲，因为发送的数据包会很多，也有可能很短时间内会积累很多数据包。</p>

<p>另外，发送时大多数的数据包都是很小很小的数据包，如果每个数据包都发送一次等待接受后再发送就会导致发送效率过低，发送太慢导致延迟过大。</p>

<p>而如果一下子把全部数据都发送的话，发送的数据可能会太大，导致发送效率很差，因为数据包越大越容易发送失败或丢包，TCP就会全盘否定这次发送的内容，并将整个包都重新发送一次，效率极其糟糕。</p>

<p>所以我们需要自己建立发送缓冲来保证发送的有序和高效，发送队列以及对发送数据的合并就是很好的策略。</p>

<p>步骤如下：</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>    1，每次当你调用发送接口时会把数据包塞入发送队列，发送程序就开始轮训是否有需要发送的信息在队列里，有的话就发送，没有的话就继续轮训等待。

    2，发送时，合并队列里的所有数据包，准备一次性发送多个数据包以提高效率。

    3，对这种合并操作做个限制，如果因为合并而导致数据包太大，也会导致效率差。发送过程中，只要丢失一个数据就要全盘重新发送，数据包很大的话，发送本来就很缓慢的情况下，又重新整体重新发送，就会使得发送效率大大降低。
</code></pre></div>
<p>我们既要合并数据包，又不能让数据包太大，这样才能保证发送的效率比较高。</p>

<p>比如我们做个合并后的数据包大小限制不得超过10K。这样每个数据包大小都处于10K以下的大小，除非单个包大于10K就让他单独发送，且每次发送包含了多个数据包，这样发送效率就有了一定的保证。</p>

<h6>协议数据定义标准</h6>

<p>在网络数据传输中协议是比较重要的一个关键点，它是客户端与服务器交流的语言。</p>

<p>什么是协议，简单来说就是客户端和服务器端商讨后达成一个对数据格式的协定，是客户端与服务器进行交流的语言，比如两边都用Json格式的协议来传输数据。这样两边在发送和收到数据时，都能够按照一定的规则识别数据了。</p>

<p>我们在实现TCP里需要对协议进行商讨，那么在商讨协议的过程中，关键点是什么呢？</p>

<p>1，    客户端和服务器都能接受的格式。并不是所有的格式都适合，选择中意的，前后端都能接受的协议格式才是最重要的，因为合作最重要，个人力量和一个协议格式的力量与团体来说都是渺小的。在团队的都理解和一致的情况下，再对协议进行精进，选择更好更高效的协议。</p>

<p>2，    数据包体大小最小化。尽可能的减少包体大小，选择一些能节省包大小空间的格式，比如google protocol buffer。或者对包主体部分使用压缩算法，我不建议只加压缩算法而不改变协议本身，因为会导致对压缩算法过度依赖而省略了协议本身的浪费空间，比如你用了压缩算法后发现xml或json格式的协议也还过得去就不再更改协议本身了，这样就会导致后期数据量大时数据包变得很大很沉重，传输效率降低。但很多老项目和一些为了加快速度而不去更改协议的项目情况时常发生，所以只启用压缩算法而不改变协议本身很多时候也是无奈之举。</p>

<p>3，    需要有一定的校验能力。当数据包体不完整时，或者本身包体后面连接着另外的数据包时，能够有校验能力，和识别完整包体范围的能力。很多时候我们在传输数据的时候，收到的并不是一个完整的包体，或者因为网络关系，收到了错误的，甚至被攥改过的数据，我们要有能力去校验他们。</p>

<p>4，    加密。为了保证网络数据包不被篡改和查看，导致外挂破坏整个游戏平衡，我们需要对发送的网络数据包中的主体部分进行加密。加密算法很多，这里不一一介绍，最简单方式就是对数据做异或处理，发送时做异或处理一次，收到时做一次异或处理，这样就能简单加密解密数据。前面说的这种方式比较单板，因为密钥Key是同一个，而且密钥KEY会暴露在客户端会被查看到，于是非对称加密是加密的首选，这样前后端两边的密钥Key不同且各自保存，即使当后端密钥泄漏时，也可以随时替换。</p>

<p>我们这里主要聊一下网络数据包的校验能力，各种包体的协议格式下面的章节中会具体讲解，加密也同样会在最后的几节部分做出详细的介绍。</p>

<p>在接收数据的时候，有时候会是一个不完整的包，或者一个包后面跟着另一段不完整的包，怎么办，怎么识别哪里是头，哪里是尾？嗯，这就有了数据格式的意义，通常的长连接数据格式，以头和数据块，两部分组成，比如头用4个字节组成，这4个字节是数据块得大小size，这样后面数据块得大小就能知道了，因为每次拿到网络数据的时候我先取4个字节，然后就知道了后面数据块大小，再读取size大小的数据块，这样就拿到了数据信息。
再做的复杂点，可以分成，头、固定标识信息、数据块，三个部分。头，存储包体大小信息；标识信息，存储例如句柄编号，序列号，特殊命令编号，校验码等的标识信息；数据块，存储具体的数据信息。</p>

<p>TCP本身有做一些校验的工作，但为了防止数据被人为攥改、网络错误、以及逻辑本身的错误检测，我们需要做额外的校验工作。</p>

<p>通常方法有几种</p>

<p>1，    MD5校验。这种校验方式比较直接，将数据块整个用MD5散列函数生成一个校验字符串，将校验字符串保存在数据包中。当服务器收到数据包时，也做同样的操作，将数据块用MD5散列函数生成一个校验字符串，与数据包中的校验字符串进行比较，如果一致，则认为校验通过，否则就认为被人为修改过。</p>

<p>2，    奇偶校验。奇偶校验与MD5有点类似，只是所用的函数方法不同。对每个数据进行异或赋值成一个变量，将这个变量保存在数据包中。当服务器收到数据包时，也做同样的操作，将数据快中的数据进行异或赋值成一个变量，然后将这个变量值与数据包中的校验值进行比较，如果数据一致则认为校验正确，否则则认为数据被人攥改过。</p>

<p>这个校验算法类似于：</p>

<figure class="highlight"><pre><code class="language-c#" data-lang="c#"><span></span><span class="n">unsigned</span> <span class="n">uCRC</span><span class="p">=</span><span class="m">0</span><span class="p">;</span><span class="c1">//校验初始值</span>
<span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="p">=</span><span class="m">0</span><span class="p">;</span><span class="n">i</span><span class="p">&lt;</span><span class="n">DataLenth</span><span class="p">;</span><span class="n">i</span><span class="p">++)</span> <span class="n">uCRC</span><span class="p">^=</span><span class="n">Data</span><span class="p">[</span><span class="n">i</span><span class="p">];</span></code></pre></figure>

<p>3，    CRC循环冗余校验。循环冗余校验是利用除法及余数的原理来进行错误检测的.将接收到的码组进行除法运算，如果除尽，则说明数据校验正确；如果未除尽，则表明数据被认为攥改过。</p>

<p>该算法过程如下：</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>    1，    前后端约定一个除数。

    2，    将数据块用除数取余。

    3，    将余数保存在数据包中。

    4，    服务器收到数据后，将余数和数据块相加，并进行取余操作。

    5，    余数为0则认为校验正确，否则则认为数据被攥改过。
</code></pre></div>
<h6>断线检测</h6>

<p>TCP本身就是强连接，所以自身就有断线的检测机制，但是它本身的检测机制还不够用，对断线的判断不够准确，所以我们需要加强断线检测机制，让断线判断变的更加准确和及时。</p>

<p>为了能有效检测TCP连接是否正常，我们需要服务器和客户端达成一个协议来检测连接。我们可以取名叫心跳包协议，在心跳包协议中，每几秒服务器向客户端发送一个心跳包，包内包含了服务器时间，服务器状态等信息，然后再由客户端发送给服务器一个心跳回应包，包内包含客户端的一些信息例如客户端状态，用户信息等，这样客户端和服务器就都知道连接是有响应的，当前是连接正常。</p>

<p>倘若没有收到心跳包和心跳回应包，就表示连接存在问题了，有可能已经断开。为了规避一些时候网络的波动，我们可以设置一个有效判断断开连接的时间间隔，比如，10秒内没有收到心跳包和心跳回应包，就表示连接已经断开，这时服务器和客户端主动断开连接，再根据游戏的逻辑寻求再次连接。</p>

<p>这种在TCP之上，加强断线检测的做法，能更有效快速得检测到断线问题。</p>

  <p>感谢您的耐心阅读</p>
  <p>Thanks for your reading</p>
</div>
<div>
  
<!-- 代码1：放在页面需要展示的位置  -->
<!-- 如果您配置过sourceid，建议在div标签中配置sourceid、cid(分类id)，没有请忽略  -->
<!-- <div id="cyReward" role="cylabs" data-use="reward" align="center" ></div> -->

<script type="text/javascript" src="/assets/js/tctip-1.0.3.min.js"></script>
<script>
  new tctip({
    top: '50%',
    button: {
      id: 9,
      type: 'zanzhu'
    },
    list: [
      {
        type: 'alipay',
        qrImg: '/assets/common/alipay.jpg'
      }, {
        type: 'wechat',
        qrImg: '/assets/common/wechatpay.jpg'
      }, {
        type: 'bitcoin',
        qrContent: '1ErCFmtoQY2KDctjgPALZri3USsMqdSvqh'
      }
    ]
  }).init()
</script>

  <li>
<p><strong><font color="red">版权申明</font></strong></p>
<!-- <p>本文为博主原创文章，未经允许不得转载: <a href = "http://www.luzexi.com">http://www.luzexi.com</a></p> -->
<p><strong><font color="red">本文为博主原创文章，未经允许不得转载:</font></strong></p>
<p><a href = "http://www.luzexi.com/2018/08/07/Unity3D%E9%AB%98%E7%BA%A7%E7%BC%96%E7%A8%8B%E4%B9%8B%E8%BF%9B%E9%98%B6%E4%B8%BB%E7%A8%8B-%E7%BD%91%E7%BB%9C%E5%B1%822.html">《Unity3D高级编程之进阶主程》第六章，网络层(二) - 实现TCP</a></p>
<!-- <p>本文为博主原创文章，未经允许不得转载: <a href = "http://www.luzexi.com/2018/08/07/Unity3D%E9%AB%98%E7%BA%A7%E7%BC%96%E7%A8%8B%E4%B9%8B%E8%BF%9B%E9%98%B6%E4%B8%BB%E7%A8%8B-%E7%BD%91%E7%BB%9C%E5%B1%822.html">《Unity3D高级编程之进阶主程》第六章，网络层(二) - 实现TCP</a></p> -->
<p><strong><font color="red">Copyright attention</font></strong></p>
<p><strong><font color="red">Please don't reprint without authorize.</font></strong></p>

</li>
  <li>
<p><strong>微信公众号，文章同步推送，致力于分享一个资深程序员在北上广深拼搏中对世界的理解</strong></p>
<p><image src="/public/qrcode_for_gzh.jpg" /></p>
</li>
</div>
<div class="related">
    
<div class="bshare-custom icon-medium-plus"><div class="bsPromo bsPromo2"></div><a title="分享到微信" class="bshare-weixin" href="javascript:void(0);"></a><a title="分享到新浪微博" class="bshare-sinaminiblog"></a><a title="分享到QQ好友" class="bshare-qqim" href="javascript:void(0);"></a><a title="分享到QQ空间" class="bshare-qzone" href="javascript:void(0);"></a><a title="分享到Twitter" class="bshare-twitter" href="javascript:void(0);"></a><a title="分享到Facebook" class="bshare-facebook" href="javascript:void(0);"></a><a title="更多平台" class="bshare-more bshare-more-icon more-style-addthis"></a></div><script type="text/javascript" charset="utf-8" src="http://static.bshare.cn/b/buttonLite.js#style=-1&amp;uuid=36b4f383-d948-41a3-acd5-31ae604e3ad8&amp;pophcol=2&amp;lang=zh"></script><script type="text/javascript" charset="utf-8" src="http://static.bshare.cn/b/bshareC0.js"></script>


</div>



<script type="text/javascript">
	if (/(iPhone|iPad|iPod|iOS|Android)/i.test(navigator.userAgent))
    { //移动端
        /*mobile-20:5*/
    	var cpro_id = "u3493987";
		document.write("\<script type=\"text\/javascript\" src=\"//cpro.baidustatic.com/cpro/ui/cm.js\"\>\<\/script\>");
    }
    else
    {
        /*760*90 创建于 2016-02-02*/
    	var cpro_id = "u2514412";
        document.write("\<script type=\"text/javascript\" src=\"//cpro.baidustatic.com/cpro/ui/c.js\"\>\<\/script\>");
	}
</script>





<div class="related">
  <h2>最新发表的文章</h2>
  <ul class="related-posts">

    
      <li>
        <h3>
          <a href="/2020/01/08/%E6%80%9D%E8%B7%AF%E6%8E%A2%E8%AE%A836.html">
            思路探讨(三十六) 英语励志文章1
            <small>08 Jan 2020</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/2020/01/05/%E6%80%9D%E8%B7%AF%E6%8E%A2%E8%AE%A835.html">
            思路探讨(三十五) 合作带来自信
            <small>05 Jan 2020</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/2020/01/02/%E6%80%9D%E8%B7%AF%E6%8E%A2%E8%AE%A834.html">
            思路探讨(三十四) 纠正错误观念
            <small>02 Jan 2020</small>
          </a>
        </h3>
      </li>
    

  </ul>

  <h2>之后发表的文章</h2>

  <ul class="related-posts">
    

    

      
      

      

    

      
      

      

    

      
      

      

    

      
      

      

    

      
      

      

    

      
      

      

    

      
      

      

    

      
      

      

    

      
      

      

    

      
      

      

    

      
      

      

    

      
      

      

    

      
      

      

    

      
      

      

    

      
      

      

    

      
      

      

    

      
      

      

    

      
      

      

    

      
      

      

    

      
      

      

    

      
      

      

    

      
      

      

    

      
      

      

    

      
      

      

    

      
      

      

    

      
      

      

    

      
      

      

    

      
      

      

    

      
      

      

    

      
      

      

    

      
      

      

    

      
      

      

    

      
      

      

    

      
      

      

    

      
      

      

    

      
      

      

    

      
      

      

    

      
      

      

    

      
      

      

    

      
      

      

    

      
      

      

    

      
      

      

    

      
      

      

    

      
      

      

    

      
      

      

    

      
      

      

    

      
      

      

    

      
      

      

    

      
      

      

    

      
      

      

    

      
      

      

    

      
      

      

    

      
      

      

    

      
      

      

    

      
      

      

    

      
      

      

    

      
      

      

    

      
      

      

    

      
      

      

    

      
      

      

    

      
      

      

    

      
      

      

    

      
      

      

    

      
      

      

    

      
      

      
        
          <li>
            <h3>
              <a href="/2018/09/30/Unity3D%E9%AB%98%E7%BA%A7%E7%BC%96%E7%A8%8B%E4%B9%8B%E8%BF%9B%E9%98%B6%E4%B8%BB%E7%A8%8B-%E5%9C%B0%E5%9B%BE%E4%B8%8E%E5%AF%BB%E8%B7%AF5.html">
                Unity3d高级编程之进阶主程 地图与寻路5
                <small>30 Sep 2018</small>
              </a>
            </h3>
          </li>
        
          <li>
            <h3>
              <a href="/2018/09/23/%E7%99%BD%E9%A2%86%E6%8A%95%E8%B5%84%E6%8E%A2%E8%AE%A86.html">
                白领投资探讨(六) 为什么不要做逆向投资，和，为什么坚决要做逆向投资的探讨
                <small>23 Sep 2018</small>
              </a>
            </h3>
          </li>
        
          <li>
            <h3>
              <a href="/2018/09/08/%E7%99%BD%E9%A2%86%E6%8A%95%E8%B5%84%E6%8E%A2%E8%AE%A85.html">
                白领投资探讨(五) 金融知识到底带给我了什么？
                <small>08 Sep 2018</small>
              </a>
            </h3>
          </li>
        
          <li>
            <h3>
              <a href="/2018/08/17/%E4%B8%AD%E5%9B%BD%E9%A1%B6%E4%BD%8F.html">
                中国，顶住！！
                <small>17 Aug 2018</small>
              </a>
            </h3>
          </li>
        
          <li>
            <h3>
              <a href="/2018/08/13/%E7%99%BD%E9%A2%86%E6%8A%95%E8%B5%84%E6%8E%A2%E8%AE%A84.html">
                白领投资探讨(四) 流动性探讨
                <small>13 Aug 2018</small>
              </a>
            </h3>
          </li>
        

        
  <!-- </ul> -->

  <h2>之前发表的文章</h2>

  <ul class="related-posts">
    

    

      

      

    

      

      

    

      

      

    

      

      

    

      

      

    

      

      

    

      

      

    

      

      

    

      

      

    

      

      

    

      

      

    

      

      

    

      

      

    

      

      

    

      

      

    

      

      

    

      

      

    

      

      

    

      

      

    

      

      

    

      

      

    

      

      

    

      

      

    

      

      

    

      

      

    

      

      

    

      

      

    

      

      

    

      

      

    

      

      

    

      

      

    

      

      

    

      

      

    

      

      

    

      

      

    

      

      

    

      

      

    

      

      

    

      

      

    

      

      

    

      

      

    

      

      

    

      

      

    

      

      

    

      

      

    

      

      

    

      

      

    

      

      

    

      

      

    

      

      

    

      

      

    

      

      

    

      

      

    

      

      

    

      

      

    

      

      

    

      

      

    

      

      

    

      

      

    

      

      

    

      

      

    

      

      

    

      

      

    

      

      

    

      

      
        
          <li>
            <h3>
              <a href="/2018/08/07/Unity3D%E9%AB%98%E7%BA%A7%E7%BC%96%E7%A8%8B%E4%B9%8B%E8%BF%9B%E9%98%B6%E4%B8%BB%E7%A8%8B-%E7%BD%91%E7%BB%9C%E5%B1%822.html">
                《Unity3D高级编程之进阶主程》第六章，网络层(二) - 实现TCP
                <small>07 Aug 2018</small>
              </a>
            </h3>
          </li>
        
          <li>
            <h3>
              <a href="/2018/08/06/Unity3D%E9%AB%98%E7%BA%A7%E7%BC%96%E7%A8%8B%E4%B9%8B%E8%BF%9B%E9%98%B6%E4%B8%BB%E7%A8%8B-%E7%BD%91%E7%BB%9C%E5%B1%821.html">
                《Unity3D高级编程之进阶主程》第六章，网络层(一) - TCP还是UDP
                <small>06 Aug 2018</small>
              </a>
            </h3>
          </li>
        
          <li>
            <h3>
              <a href="/2018/08/06/Unity3D%E9%AB%98%E7%BA%A7%E7%BC%96%E7%A8%8B%E4%B9%8B%E8%BF%9B%E9%98%B6%E4%B8%BB%E7%A8%8B-3D%E6%A8%A1%E5%9E%8B%E4%B8%8E%E5%8A%A8%E7%94%BB3.html">
                《Unity3D高级编程之进阶主程》第五章，3D模型与动画(三) - 状态机
                <small>06 Aug 2018</small>
              </a>
            </h3>
          </li>
        
          <li>
            <h3>
              <a href="/2018/08/03/%E8%A2%AB%E5%B0%81%E7%BA%AA%E5%BF%B5%E5%B8%96.html">
                被封纪念帖
                <small>03 Aug 2018</small>
              </a>
            </h3>
          </li>
        
          <li>
            <h3>
              <a href="/2018/08/03/git%E5%90%8C%E6%AD%A5%E5%A4%9A%E4%B8%AArepository%E4%BB%93%E5%BA%93.html">
                git同步多个repository仓库
                <small>03 Aug 2018</small>
              </a>
            </h3>
          </li>
        

        
  </ul>
</div>




<!--PC和WAP自适应版-->
<div id="SOHUCS" ></div> 
<script type="text/javascript"> 
(function(){ 
var appid = 'cys17tiy3'; 
var conf = 'prod_3b20e80a06c760385d4781c30f8ebf5c'; 
var width = window.innerWidth || document.documentElement.clientWidth; 
if (width < 960) {
var head = document.getElementsByTagName('head')[0]||document.head||document.documentElement;
var script = document.createElement('script');
script.type = 'text/javascript';
script.charset = 'utf-8';
script.id = 'changyan_mobile_js';
script.src = 'https://changyan.sohu.com/upload/mobile/wap-js/changyan_mobile.js?client_id=' + appid + '&conf=' + conf;
head.appendChild(script);
} else { var loadJs=function(d,a){var c=document.getElementsByTagName("head")[0]||document.head||document.documentElement;var b=document.createElement("script");b.setAttribute("type","text/javascript");b.setAttribute("charset","UTF-8");b.setAttribute("src",d);if(typeof a==="function"){if(window.attachEvent){b.onreadystatechange=function(){var e=b.readyState;if(e==="loaded"||e==="complete"){b.onreadystatechange=null;a()}}}else{b.onload=a}}c.appendChild(b)};loadJs("https://changyan.sohu.com/upload/changyan.js",function(){window.changyan.api.config({appid:appid,conf:conf})}); } })(); </script>




<script type="text/javascript">
	if (/(iPhone|iPad|iPod|iOS|Android)/i.test(navigator.userAgent))
    { //移动端
        /*mobile-悬浮20:3*/
    	var cpro_id = "u3495898";
		document.write("\<script type=\"text\/javascript\" src=\"//cpro.baidustatic.com/cpro/ui/cm.js\"\>\<\/script\>");
    }
    else
    {
        /*500*200-1*/
        var cpro_id = "u3486033";
        document.write("\<script type=\"text/javascript\" src=\"//cpro.baidustatic.com/cpro/ui/c.js\"\>\<\/script\>");
	}
</script>
 



    </div>

    
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?f3d58556a7396e715b3602ef6754cd91";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>


    <script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>

  </body>
  
</html>
